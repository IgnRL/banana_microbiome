---
title: "Banana project, organic matter-microbiome"
output: html_document
date: "`r Sys.Date()`"
---

```{r, include=FALSE}
library(ggplot2)
library(tidyverse)
library(ggpubr)
library(gridExtra)
library(corrplot)
library(agricolae)
library(emmeans)
library(multcomp)
library(multcompView)
library(data.table)
library(tidyverse)
library(phyloseq)
library(vegan)
library(ape)
library(here)
library(readxl)
library(ggpubr)
library(geomtextpath)
library(knitr)
library(gridExtra)
library(Biostrings)
library(seqinr)
library(FSA)
library(agricolae)
library(MASS)
library(grid)
library(gridExtra)
library(emmeans)
library(multcomp)
library(broom)
library(viridis)
library(ALDEx2)
library(FactoMineR)
library(factoextra)
library(kableExtra)
library(scales)
library(dunn.test)
library(car)
library(corrplot)
library(eulerr)
library(ggforce)
library(ggrepel)
library(rstatix)
library(AICcmodavg)
library(ggthemes)

```


# Data analysis octubre 2023
Add the information of each method to obtain each parameter 


```{r colors, include=FALSE}
treat.colors <- c("control"= "green4" ,"control.amf"  = "darkseagreen" , "chicken.manure"= "royalblue1", "cow.manure" = "red3","mo.pellet"= "darkorchid1","compost"="chocolate4","control.legumes"="darkolivegreen4")
treat.colors
treat.order <- c('control', 'control.amf', 'control.legume', "compost", "chicken.manure", "cow.manure", "mo.pellet") 
treat.labels <- c("Control", "Control\nAMF", "Control\nLegume", "Compost", "Chicken\nmanure", "Cow\nmanure", "Pellet")

```

## Properties of soil

Method to obtain each parameter. 

Five hundred grams of each soil sample were processed. The soils were air-dried at room temperature, sieved through a 2 mm sieve and homogenized. 
Oxidizable organic matter (%) was analyzed by oxidation with potassium dichromate in an acid medium and titrated with Mohr's salt, using a procedure adapted from that described by Walkley et al. (1934). 
Assimilable phosphorus (mg/kg) was analyzed according to the colorimetric method of Olsen et al. (1954). 
Soil exchange cations (mEq/kg), calcium, magnesium, potassium and sodium, were extracted with neutral 1N ammonium acetate and determined by flame atomic absorption spectrophotometry (Bower et al., 1952). 
The pH in aqueous extract 1:5 (v:v) and in potassium chloride extract 1:5 (v:v) were determined by potentiometry with a combined glass electrode, with a procedure based on UNE-ISO 10390:2012 (2012).
The electrical conductivity in extract 1:5 (mS/cm, µS/cm) by conductivity meter with the method based on UNE-EN 77308:2001 (2001). 

The analyses of these parameters were carried out by the Laboratory Unit of the Canarian Institute of Agricultural Research (ICIA) Canary Island, Spain.

```{r Import, include=FALSE}
#Esto se ha hecho para cargar el Excel de los datos iniciales (ojo, para poner el directorio de donde esta tu archivo excel, se tiene que cambiar \, por /), y para hacer la media de cada tratamiento, ya que de cada tratamiento hay 3 repeticiones. El simbolo %>% se llaman tuberias (the pipe) vienen de la libreria (tinyverse) (esta libreria sirve para mantener R más ordenado). Las tuberias funcionan usando el resultado de una operación(out) y convirtiendolo en el imput de otra. En el caso del codigo  "soil.summ <- soil_prop %>% group_by(treatment,  time) %>% summarise(across(.cols=everything(), .fns=mean),.groups = "drop")" quiere decir lo siguiente: hemos creado un objeto nuevo que es soil.summ, que es_ el archivo de excel soil_prop el que hacemos una serie de operaciones en cadena (tuberia) donde agrupamos solamente por tratamiento y tiempo (group_by,) y en ese agrupamiento queremos de todas las columnas, .cols=every, que haga la funcion de la media (fns=mean). NULL significa que no tenga en cuenta esas columnas. $ es para seleccionar cosas especificas. 

soil_prop <- readxl::read_excel("C:/Users/raquel.correa/Documents/banana_microbiome/raw_files/soil_prop_2.xlsx")

soil.summ <- soil_prop %>% group_by(treatment,  time) %>% 
  summarise(across(.cols=everything(),.fns=mean),.groups = "drop")

soil.summ.sd <- soil_prop %>% group_by(treatment,  time) %>% 
  summarise(across(.cols=everything(),.fns=list(mean = mean, sd = sd)),.groups = "drop")

soil.summ$rep <- NULL
soil.summ$soil.id <- NULL

```

### Evolucion de cada parametros en los distintos muestreos del experimento


```{r over the time, include=FALSE}

#En este codigo veremos la evolucion de los distintos parametros en el tiempo. La función "aes" sirve para indicar en un grafico cual es tu X,y. Debes indicar en texto quien es quien.Toda la información de los datos referido al grafico es lo que va dentro del parentesis. Los adornos van fuera con el signo de +. La funcion "geom_line" sirve para elegir el tipo de grafico que quieres. 


org.mat.plotsd <- soil.summ.sd%>% ggplot(aes(x=time, group= treatment, col= treatment, y= org.matter_mean))+
  geom_line()+
  theme_classic()+
  xlab("")+
  ylab("Oxidable organic matter (%)")+
  scale_color_manual(values= treat.colors)+
  geom_point()+
  geom_errorbar(aes(ymin=org.matter_mean-org.matter_sd, ymax=org.matter_mean+org.matter_sd), width=0.2)
org.mat.plotsd

phosp.plotsd <- soil.summ.sd%>% ggplot(aes(x=time, group= treatment, col= treatment, y=phosphorus_mean))+
  geom_line()+
  theme_classic()+
  xlab("")+
  ylab("Phosphorus mg/Kg")+
  scale_color_manual(values= treat.colors)+
  geom_point()+
  geom_errorbar(aes(ymin=phosphorus_mean-phosphorus_sd, ymax=phosphorus_mean+phosphorus_sd), width=0.2)
phosp.plotsd

calcium.plotsd <- soil.summ.sd%>% ggplot(aes(x=time, group= treatment, col= treatment, y= calcium_mean))+
  geom_line()+
  theme_classic()+
  xlab("")+
  ylab("Calcium mEq/kg")+
  scale_color_manual(values= treat.colors)+
  geom_point()+
  geom_errorbar(aes(ymin=calcium_mean-calcium_sd, ymax=calcium_mean+calcium_sd), width=0.2)
calcium.plotsd

sodium.plotsd <- soil.summ.sd%>% ggplot(aes(x=time, group= treatment, col= treatment, y= sodium_mean))+
  geom_line()+
  theme_classic()+
  xlab("")+
  ylab("Sodium mEq/kg")+
  scale_color_manual(values= treat.colors)+
  geom_point()+
  geom_errorbar(aes(ymin=sodium_mean-sodium_sd, ymax=sodium_mean+sodium_sd), width=0.2)
sodium.plotsd

potassium.plotsd <- soil.summ.sd%>% ggplot(aes(x=time, group= treatment, col= treatment, y= potassium_mean))+
  geom_line()+
  theme_classic()+
  xlab("")+
  ylab("Potassium mEq/kg")+
  scale_color_manual(values= treat.colors)+
  geom_point()+
  geom_errorbar(aes(ymin=potassium_mean-potassium_sd, ymax=potassium_mean+potassium_sd), width=0.2)
potassium.plotsd

pH_water.plotsd <- soil.summ.sd%>% ggplot(aes(x=time, group= treatment, col= treatment, y= ph.water_mean))+
  geom_line()+
  theme_classic()+
  xlab("")+
  ylab("pH water udes.")+
  scale_color_manual(values= treat.colors)+
  geom_point()+
  geom_errorbar(aes(ymin=ph.water_mean-ph.water_sd, ymax=ph.water_mean+ph.water_sd), width=0.2)
pH_water.plotsd

conductivity.plotsd <- soil.summ.sd%>% ggplot(aes(x=time, group= treatment, col= treatment, y= conductivity_mean))+
  geom_line()+
  theme_classic()+
  xlab("")+
  ylab("Conductivity mS/cm")+
  scale_color_manual(values= treat.colors)+
  geom_point()+
  geom_errorbar(aes(ymin=conductivity_mean-conductivity_sd, ymax=conductivity_mean+conductivity_sd), width=0.2)
conductivity.plotsd

nitrogen.plotsd <- soil.summ.sd%>% ggplot(aes(x=time, group= treatment, col= treatment, y= nitrogen_mean))+
  geom_line()+
  theme_classic()+
  xlab("Time")+
  ylab("Nitrogen (%)")+
  scale_color_manual(values= treat.colors)+
  geom_point()+
  geom_errorbar(aes(ymin=nitrogen_mean-nitrogen_sd, ymax=nitrogen_mean+nitrogen_sd), width=0.2)
nitrogen.plotsd

```


```{r together, echo=FALSE}

figureall <- ggarrange(org.mat.plotsd, phosp.plotsd, pH_water.plotsd, potassium.plotsd, sodium.plotsd,calcium.plotsd, nitrogen.plotsd, conductivity.plotsd,
                    labels = c("A", "B", "C", "D", "E", "F", "G", "H"),
                    font.label = list (size = 10, color= "black", position= "right"),
                    common.legend = TRUE, legend = "bottom",
                    vjust = 10,
                    ncol = 3, nrow = 3)
title <- text_grob("Soil properties over the time", 
                                color ="black", face = "bold", size = 14)


figure_title <- annotate_figure(figureall, 
                top=title, 
                bottom = text_grob("Mean and sd of each treatments"))

grid.draw(figure_title)

```

### Analisis estadistico.

### Check the correlation between the variables to analyse the most interesting ones.

```{r Correlogram, echo=FALSE}
soil_prop_cor <- soil_prop
soil_prop_cor$rep <- NULL
soil_prop_cor$soil.id <- NULL
soil_prop_cor$treatment <- NULL
soil_prop_cor$time <- NULL
cor.matrix <- soil_prop_cor %>% cor()

cor.mat.test <- cor.mtest(cor.matrix)

corrplot(cor.matrix, p.mat=cor.mat.test$p, sig.level = 0.05, order= "hclust", type= "upper", method= "number", insig = "pch", pch=4,number.cex = 0.75)
```

The most interesing variables seem to be pH.water, organic matter, conductivity and NPKCa values. The rest could be omitted. 

## Differences between treatments at the start of the experiment (t0)

Para comprobar si hay diferencias significativas o no. 
1.Dif. entre tratamientos y tiempos. 
2.Dif. entre 1 tratamiento a lo largo del tiempo. 

```{r Materia organica stats, echo=FALSE}

#Vamos analizar diferencias en el primer muestreo (to), por ello usamos la funcion subset que es un condicional como simbolo de dolar o funcion subset, para elegir determinadas variables dentro de un objeto,  significa solo analizar del archivo soil_prop, la columan soil_prop$time que sea igual a t0). Le hacemos un modelo de regresion lineal, o se puede analizar directamnte con anova. 
#comprobamos la normalidad de los datos por tratamiento y no entre tratamientos. Los datos al interaccionar entre tratamietnos no son normales, ya que por los procesos biologicos son mas altos en algunos tratamientos que otros. Asumiendo esto, los analisis estadisticos se haran igualmente con aproximacion parametrica. 

soilt0 <- subset(soil_prop, soil_prop$time== "t0")
str(soilt0)

shapiro.test(soilt0$org.matter)#ahora vamos a comprobar la normalidad de los datos. Los datos no son normales. 
soil_prop %>% group_by(treatment) %>% shapiro_test(org.matter) #aqui comprobamos la normalidad de los datos de materia organica en cada tratamiento. Todos son normales.

ggqqplot(data = soil_prop, "org.matter", facet.by = "treatment")

anova_orgmattert0 <- aov(org.matter ~ treatment, data=soilt0) #hay diferencias significativas
summary(anova_orgmattert0)
plot(anova_orgmattert0, which=2)
leveneTest(org.matter~ treatment, data=soilt0) #test de Levene para el analisis de la varianza

#Puesto que hay direferencias sig. vamos a comprobar entre que tratamientos. POST-HOC.

#### hsd tukey from agricolae::
tukey_orgmatter <- HSD.test(anova_orgmattert0, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
tukey_orgmatter

#crear un grafico con la media de la los valores de materia organica de t0, y la letra de HSDTukey)

avgm <- aggregate(org.matter ~ treatment, data=soilt0, FUN= mean)
plot_orgmatter_t0 <- soilt0 %>% ggplot(aes(x= factor(treatment, level= treat.order), 
                                           y= org.matter, col=treatment))+
  geom_point(size= 6)+
  scale_color_manual(values= treat.colors)+
  ylab("Oxidable organic matter (%)")+
  xlab("")+
  scale_x_discrete(labels= treat.labels)+
  theme_clean()+
  stat_summary(fun=mean, aes(x= treatment, y = org.matter),
               geom= "crossbar", width=0.5, colour= "grey20", data=avgm)+
  geom_text(data=tukey_orgmatter, aes(x=treatment, y = org.matter, label= groups), color="black", nudge_x= 0.2, nudge_y= 0.2)+
  labs(title = "Differences in the percentage of oxidizable organic matter T0.", 
       subtitle = "Three measures of each treatment", caption = "Anova p-value: 2.5e-13 (HSDTukey)", size = 10 )
plot_orgmatter_t0

```

```{r Phosphorous stats, echo=FALSE}
shapiro.test(soilt0$phosphorus)#data no normal 
soilt0 %>% group_by(treatment) %>% shapiro_test(phosphorus) #all treatment are normal
ggqqplot(data = soil_prop, "phosphorus", facet.by = "treatment")
anova_phosphto <- aov(phosphorus ~ treatment, data=soilt0)
summary(anova_phosphto)
plot(anova_phosphto, which=2)
leveneTest(phosphorus~ treatment, data= soilt0)#se cumple el supuesto de homogenicidad de varianzas.
tukey_phosphorus <- HSD.test(anova_phosphto, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")

avgpho <- aggregate(phosphorus ~ treatment, data=soilt0, FUN= mean)
plot_phosphorus_t0 <- soilt0 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= phosphorus, col=treatment))+
  geom_point(size= 6)+
  scale_color_manual(values= treat.colors)+
  ylab("Phosphorus mg/Kg")+
  xlab("")+
  scale_x_discrete(labels= treat.labels)+
  theme_clean()+
  stat_summary(fun=mean, aes(x= treatment, y = phosphorus),
               geom= "crossbar",  width=0.5, colour= "grey20", data=avgpho)+
  geom_text(data=tukey_phosphorus, aes(x=treatment, y = phosphorus, label= groups), 
            colour="black", nudge_x= 0.2, nudge_y= 3)+
  labs(title = "Differences in phosphorus T0.", subtitle = "Three measures of each treatment" , caption = "Anova p-value: 0.000186 (HSDTukey)" )
plot_phosphorus_t0

```

```{r ph water stast, echo=FALSE}
shapiro.test(soilt0$ph.water)
soilt0 %>% group_by(treatment) %>% shapiro_test(ph.water) #normal data
ggqqplot(data = soil_prop, "ph.water", facet.by = "treatment")

anova_phwatert0 <- aov(ph.water ~ treatment, data=soilt0)
summary(anova_phwatert0)
plot(anova_phwatert0, which=2)
leveneTest(ph.water~ treatment, data= soilt0)#se cumple el supuesto de homogenicidad de varianzas.

tukey_phwater <- HSD.test(anova_phwatert0, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")

avgphwater <- aggregate(ph.water ~ treatment, data=soilt0, FUN= mean)
plot_phwater_t0 <- soilt0 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= ph.water, col=treatment))+
  geom_point(size= 6)+
  scale_color_manual(values= treat.colors)+
  ylab("pH water udes.")+
  xlab("")+
  theme_classic2()+
  scale_x_discrete(labels= treat.labels)+
  stat_summary(fun=mean, aes(x= treatment, y = ph.water),
               geom= "crossbar",  width=0.5, colour= "grey20", data=avgphwater)+
  geom_text(data=tukey_phwater, aes(x=treatment, y = ph.water, label= groups), 
            colour="black", nudge_x= 0.2, nudge_y= 0.05)+
  labs(title = "Differences in pH water udes. T0.", subtitle = "Three measures of each treatment" , caption = "Anova p-value: 4.21e-07 (HSDTukey)" )

plot_phwater_t0

```

```{r conductivity stats, echo=FALSE}
shapiro.test(soilt0$conductivity) #data no normal 
soil_prop %>% group_by(treatment) %>% shapiro_test(conductivity) #all treatment are normal
ggqqplot(data = soil_prop, "conductivity", facet.by = "treatment")
anova_conductivityt0 <- aov(conductivity ~ treatment, data=soilt0)
summary(anova_conductivityt0)
plot(anova_conductivityt0, which=2)
leveneTest(conductivity~ treatment, data= soilt0) #no equal variance
tukey_conductivity <- HSD.test(anova_conductivityt0, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
avgconduc <- aggregate(conductivity ~ treatment, data=soilt0, FUN= mean)

plot_conduc_t0 <- soilt0 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= conductivity, col=treatment))+
  geom_point(size= 6)+
  scale_color_manual(values= treat.colors)+
  ylab("Conductivity mS/cm.")+
  xlab("")+
  theme_classic2()+
  scale_x_discrete(labels= treat.labels)+
  stat_summary(fun=mean, aes(x= treatment, y = conductivity),
               geom= "crossbar",  width=0.5, colour= "grey20", data=avgconduc)+
  geom_text(data=tukey_conductivity, aes(x=treatment, y = conductivity, label= groups), 
            colour="black", nudge_x= 0.2, nudge_y= 0.05)+
  labs(title = "Differences in conductivity. T0.", subtitle = "Three measures of each treatment" , caption = "Anova p-value: 1.89e-07 (HSDTukey)" )
plot_conduc_t0

```


```{r stats calcium, echo=FALSE}
shapiro.test(soilt0$calcium)#normal data
anova_calciumt0 <- aov(calcium ~ treatment, data=soilt0)
summary(anova_calciumt0)
plot(anova_calciumt0, which=2)
leveneTest(calcium~ treatment, data= soilt0)#equal variance

tukey_calcium <- HSD.test(anova_calciumt0, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
tukey_calcium
avgcalcium <- aggregate(calcium ~ treatment, data=soilt0, FUN= mean)

plot_calcium_t0 <- soilt0 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= calcium, col=treatment))+
  geom_point(size= 6)+
  scale_color_manual(values= treat.colors)+
  ylab("Calcium mEq/kg.")+
  xlab("")+
  theme_classic2()+
  scale_x_discrete(labels= treat.labels)+
  stat_summary(fun=mean, aes(x= treatment, y = calcium),
               geom= "crossbar",  width=0.5, colour= "grey20", data=avgcalcium)+
  geom_text(data=tukey_calcium, aes(x=treatment, y = calcium, label= groups), 
            colour="black", nudge_x= 0.2, nudge_y= 0.05)+
  labs(title = "Differences in calcium T0.", subtitle = "Three measures of each treatment" , caption = "Anova p-value: 3.5e-06 (HSDTukey)" )
plot_calcium_t0


```

```{r stats sodium, echo=FALSE}
shapiro.test(soilt0$sodium)#normal data
anova_sodiumt0 <- aov(sodium ~ treatment, data=soilt0)
summary(anova_sodiumt0)
plot(anova_sodiumt0, which=2)
leveneTest(sodium~ treatment, data= soilt0)

tukey_sodium <- HSD.test(anova_sodiumt0, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
tukey_sodium
avgsodium <- aggregate(sodium ~ treatment, data=soilt0, FUN= mean)

plot_sodium_t0 <- soilt0 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= sodium, col=treatment))+
  geom_point(size= 6)+
  scale_color_manual(values= treat.colors)+
  ylab("sodium mEq/kg.")+
  xlab("")+
  theme_classic2()+
  scale_x_discrete(labels= treat.labels)+
  stat_summary(fun=mean, aes(x= treatment, y = sodium),
               geom= "crossbar",  width=0.5, colour= "grey20", data=avgsodium)+
  geom_text(data=tukey_sodium, aes(x=treatment, y = sodium, label= groups), 
            colour="black", nudge_x= 0.2, nudge_y= 0.2)+
  labs(title = "Differences in sodium T0.", subtitle = "Three measures of each treatment" , caption = "Anova p-value: ns (HSDTukey)" )
plot_sodium_t0

```

```{r stats potassium, echo=FALSE}
shapiro.test(soilt0$potassium) #normal data
anova_potassiumt0 <- aov(potassium ~ treatment, data=soilt0)
summary(anova_potassiumt0)
plot(anova_potassiumt0, which=2)
leveneTest(potassium~ treatment, data= soilt0) #equal variance

tukey_potassium <- HSD.test(anova_potassiumt0, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
avgpotassium <- aggregate(potassium ~ treatment, data=soilt0, FUN= mean)

plot_potassium_t0 <- soilt0 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= potassium, col=treatment))+
  geom_point(size= 6)+
  scale_color_manual(values= treat.colors)+
  ylab("potassium mEq/kg.")+
  xlab("")+
  theme_classic2()+
  scale_x_discrete(labels= treat.labels)+
  stat_summary(fun=mean, aes(x= treatment, y = potassium),
               geom= "crossbar",  width=0.5, colour= "grey20", data=avgpotassium)+
  geom_text(data=tukey_potassium, aes(x=treatment, y = potassium, label= groups), 
            colour="black", nudge_x= 0.2, nudge_y= 0.6)+
  labs(title = "Differences in potassium T0.", subtitle = "Three measures of each treatment" , caption = "Anova p-value: 1.16e-05 (HSDTukey)" )

plot_potassium_t0


```


```{r stats nitrogent0, echo=FALSE}
shapiro.test(soilt0$nitrogen)#data no normal 
soil_prop %>% group_by(treatment) %>% shapiro_test(nitrogen) #all the treatments are normal
ggqqplot(data = soil_prop, "nitrogen", facet.by = "treatment")
anova_nitrogen0 <- aov(nitrogen ~ treatment, data=soilt0)
summary(anova_nitrogen0)
plot(anova_nitrogen0, which=2)
leveneTest(nitrogen~ treatment, data= soilt0)

tukey_nitrogen <- HSD.test(anova_nitrogen0, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
avgnitrogen <- aggregate(nitrogen ~ treatment, data=soilt0, FUN= mean)

plot_nitrogen_t0 <- soilt0 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= nitrogen, col=treatment))+
  geom_point(size= 6)+
  scale_color_manual(values= treat.colors)+
  ylab("nitrogen (%)")+
  xlab("")+
  theme_classic2()+
  scale_x_discrete(labels= treat.labels)+
  stat_summary(fun=mean, aes(x= treatment, y = nitrogen),
               geom= "crossbar",  width=0.5, colour= "grey20", data=avgnitrogen)+
  geom_text(data=tukey_nitrogen, aes(x=treatment, y = nitrogen, label= groups), 
            colour="black", nudge_x= 0.2, nudge_y= 0.01)+
  labs(title = "Differences in nitrogen T0.", subtitle = "Three measures of each treatment" , caption = "Anova p-value: 3.65e-09 (HSDTukey)" )

plot_nitrogen_t0


```

### Differences between treatments at the end of the experiment (t4)


```{r stats org.matter at the end, inclue=TRUE}
soilt4 <- subset(soil_prop, soil_prop$time== "t4")

shapiro.test(soilt4$org.matter) #normal data
anova_orgmattert4 <- aov(org.matter ~ treatment, data=soilt4) #sig. different
summary(anova_orgmattert4)
plot(anova_orgmattert4, which=2)
leveneTest(org.matter~ treatment, data=soilt4) #equal variances 

#### hsd tukey from agricolae::
tukey_orgmattert4 <- HSD.test(anova_orgmattert4, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
avgmt4 <- aggregate(org.matter ~ treatment, data=soilt4, FUN= mean)

avgmt4
plot_orgmatter_t4 <- soilt4 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= org.matter, col=treatment))+
  geom_point(shape= 15, size=5)+
  scale_color_manual(values= treat.colors)+
  ylab("Oxidable organic matter (%)")+
  xlab("")+
  scale_x_discrete(labels= treat.labels)+
  theme_clean()+
  stat_summary(fun=mean, aes(x= treatment, y = org.matter),
               geom= "crossbar", width=0.6, colour= "black", data=avgmt4)+
  geom_text(data=tukey_orgmattert4, aes(x=treatment, y = org.matter, label= groups), color="black", nudge_x= 0.2, nudge_y= 0.2)+
  labs(title = "Differences in the percentage of oxidizable organic matter T4.", 
       subtitle = "Three measures of each treatment", caption = "Anova p-value: 9.82e-08 (HSDTukey)", size = 10 )
plot_orgmatter_t4


```


```{r pho stas t4, echo=FALSE}
shapiro.test(soilt4$phosphorus) #no normal data
soilt4 %>% group_by(treatment) %>% shapiro_test(phosphorus) # all treatments normal
ggqqplot(data = soil_prop, "phosphorus", facet.by = "treatment")

anova_phosht4 <- aov(phosphorus ~ treatment, data=soilt4) #sig. different
summary(anova_phosht4)
plot(anova_phosht4, which=2)
leveneTest(phosphorus~ treatment, data=soilt4) #equal variances 

tukey_phosphorust4 <- HSD.test(anova_phosht4, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
avgpho4 <- aggregate(phosphorus ~ treatment, data=soilt4, FUN= mean)

plot_phosphorus_t4 <- soilt4 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= phosphorus, col=treatment))+
  geom_point(shape= 15, size=5)+
  scale_colour_manual(values= treat.colors)+
  ylab("Phosphorus mg/Kg")+
  xlab("")+
  scale_x_discrete(labels= treat.labels)+
  theme_clean()+
  stat_summary(fun=mean, aes(x= treatment, y = phosphorus),
               geom= "crossbar", width=0.6, colour= "black", data=avgpho4)+
  geom_text(data=tukey_phosphorust4, aes(x=treatment, y = phosphorus, label= groups), color="black", nudge_x= 0.2, nudge_y= 3)+
  labs(title = "Differences in phosphorus T4.", 
       subtitle = "Three measures of each treatment", caption = "Anova p-value: 7.49e-09 (HSDTukey)", size = 10 )


plot_phosphorus_t4
```



```{r stats ph water t4, echo=FALSE}
shapiro.test(soilt4$ph.water) #no normal data
soil_prop %>% group_by(treatment) %>% shapiro_test(ph.water) # each treatments are normal 
ggqqplot(data = soil_prop, "ph.water", facet.by = "treatment")

anova_phwatert4 <- aov(ph.water ~ treatment, data=soilt4) #sig. different
summary(anova_phwatert4)
plot(anova_phwatert4, which=2)
leveneTest(ph.water~ treatment, data=soilt4) #equal variances 

tukey_phwatert4 <- HSD.test(anova_phwatert4, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")

avgphwatert4 <- aggregate(ph.water ~ treatment, data=soilt4, FUN= mean)
avgphwatert4
plot_phwater_t4 <- soilt4 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= ph.water, col=treatment))+
  geom_point(shape= 15, size=5)+
  scale_colour_manual(values= treat.colors)+
  ylab("pH water udes.")+
  xlab("")+
  scale_x_discrete(labels= treat.labels)+
  theme_clean()+
  stat_summary(fun=mean, aes(x= treatment, y = ph.water),
               geom= "crossbar", width=0.6, colour= "black", data=avgphwatert4)+
  geom_text(data=tukey_phwatert4, aes(x=treatment, y = ph.water, label= groups), color="black", nudge_x= 0.2, nudge_y= 0.05)+
  labs(title = "Differences in pH water udes. T4.", 
       subtitle = "Three measures of each treatment", caption = "Anova p-value: 0.00313 (HSDTukey)", size = 10 )

plot_phwater_t4
```

```{r stats conductivity t4, include=FALSE}
shapiro.test(soilt4$conductivity) #no normal data
soil_prop %>% group_by(treatment) %>% shapiro_test(conductivity) # each treatments are normal 
ggqqplot(data = soil_prop, "conductivity", facet.by = "treatment")

anova_conductivityt4 <- aov(conductivity ~ treatment, data=soilt4) #sig. different
summary(anova_conductivityt4)
leveneTest(conductivity~ treatment, data=soilt4) #equal variances 
tukey_conductivityt4 <- HSD.test(anova_conductivityt4, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
avgconduct4 <- aggregate(conductivity ~ treatment, data=soilt4, FUN= mean)

plot_conduc_t4 <- soilt4 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= conductivity, col=treatment))+
  geom_point(shape= 15, size=5)+
  scale_colour_manual(values= treat.colors)+
  ylab("Conductivity mS/cm.")+
  xlab("")+
  scale_x_discrete(labels= treat.labels)+
  theme_clean()+
  stat_summary(fun=mean, aes(x= treatment, y = conductivity),
               geom= "crossbar", width=0.6, colour= "black", data=avgconduct4)+
  geom_text(data=tukey_conductivityt4, aes(x=treatment, y = conductivity, label= groups), color="black", nudge_x= 0.2, nudge_y= 0.03)+
  labs(title = "Differences in conductivity T4.", 
       subtitle = "Three measures of each treatment", caption = "Anova p-value: 0.00139 (HSDTukey)", size = 10 )

plot_conduc_t4
```


```{r stats calcium t4, echo=FALSE}
shapiro.test(soilt4$calcium) #normal data
anova_calciumt4 <- aov(calcium ~ treatment, data=soilt4) #sig. different
summary(anova_calciumt4)
leveneTest(calcium~ treatment, data=soilt4) # equal variances 

tukey_calciumt4 <- HSD.test(anova_calciumt4, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
avgcalciumt4 <- aggregate(calcium ~ treatment, data=soilt4, FUN= mean)
plot_calcium_t4 <- soilt4 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= calcium, col=treatment))+
  geom_point(shape= 15, size=5)+
  scale_colour_manual(values= treat.colors)+
  ylab("Calcium mEq/kg.")+
  xlab("")+
  scale_x_discrete(labels= treat.labels)+
  theme_clean()+
  stat_summary(fun=mean, aes(x= treatment, y = calcium),
               geom= "crossbar", width=0.6, colour= "black", data=avgcalciumt4)+
  geom_text(data=tukey_calciumt4, aes(x=treatment, y = calcium, label= groups), color="black", nudge_x= 0.2, nudge_y= 3)+
  labs(title = "Differences in calcium T4.", 
       subtitle = "Three measures of each treatment", caption = "Anova p-value: 7.89e-07 (HSDTukey)", size = 10 )
plot_calcium_t4
```



```{r stats sodium t4, echo=FALSE}
shapiro.test(soilt4$sodium) #normal data
anova_sodiumt4 <- aov(sodium ~ treatment, data=soilt4) #sig. different
summary(anova_sodiumt4)
plot(anova_sodiumt4, which=2)
leveneTest(sodium~ treatment, data=soilt4) # equal variances 

tukey_sodiumt4 <- HSD.test(anova_sodiumt4, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
avgsodiumt4 <- aggregate(sodium~ treatment, data=soilt4, FUN= mean)

plot_sodium_t4 <- soilt4 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= sodium, col=treatment))+
  geom_point(shape= 15, size=5)+
  scale_colour_manual(values= treat.colors)+
  ylab("sodium mEq/kg.")+
  xlab("")+
  scale_x_discrete(labels= treat.labels)+
  theme_clean()+
  stat_summary(fun=mean, aes(x= treatment, y = sodium),
               geom= "crossbar", width=0.6, colour= "black", data=avgsodiumt4)+
  geom_text(data=tukey_sodiumt4, aes(x=treatment, y = sodium, label= groups), color="black", nudge_x= 0.2, nudge_y= 0.5)+
  labs(title = "Differences in sodium T4.", 
       subtitle = "Three measures of each treatment", caption = "Anova p-value: 0.00259 (HSDTukey)", size = 10 )

plot_sodium_t4
```


```{r stats potassium t4, echo=FALSE}
shapiro.test(soilt4$potassium) #no normal data
soilt4 %>% group_by(treatment) %>% shapiro_test(potassium) # each treatments are normal 
anova_potassiumt4 <- aov(potassium ~ treatment, data=soilt4) #sig. different
summary(anova_potassiumt4)
plot(anova_potassiumt4, which=2)
leveneTest(potassium~ treatment, data=soilt4) # equal variances 
tukey_potassiumt4 <- HSD.test(anova_potassiumt4, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
avgpotassiumt4 <- aggregate(potassium~ treatment, data=soilt4, FUN= mean)

plot_potassium_t4 <- soilt4 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= potassium, col=treatment))+
  geom_point(shape= 15, size=5)+
  scale_colour_manual(values= treat.colors)+
  ylab("potassium mEq/kg.")+
  xlab("")+
  scale_x_discrete(labels= treat.labels)+
  theme_clean()+
  stat_summary(fun=mean, aes(x= treatment, y = potassium),
               geom= "crossbar", width=0.6, colour= "black", data=avgpotassiumt4)+
  geom_text(data=tukey_potassiumt4, aes(x=treatment, y = potassium, label= groups), color="black", nudge_x= 0.2, nudge_y= 0.5)+
  labs(title = "Differences in potassium T4.", 
       subtitle = "Three measures of each treatment", caption = "Anova p-value: 0.00645 (HSDTukey)", size = 10 )

plot_potassium_t4
```

```{r stats nitrogent4, echo=FALSE}
shapiro.test(soilt4$nitrogen) #normal data
anova_nitrogent4 <- aov(nitrogen ~ treatment, data=soilt4) #sig. different
summary(anova_nitrogent4)
plot(anova_nitrogent4, which=2)
leveneTest(nitrogen~ treatment, data=soilt4) # equal variances 

tukey_nitrogent4 <- HSD.test(anova_nitrogent4, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
avgnitrogent4 <- aggregate(nitrogen~ treatment, data=soilt4, FUN= mean)

plot_nitrogen_t4 <- soilt4 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= nitrogen, col=treatment))+
  geom_point(shape= 15, size=5)+
  scale_colour_manual(values= treat.colors)+
  ylab("nitrogen (%).")+
  xlab("")+
  scale_x_discrete(labels= treat.labels)+
  theme_clean()+
  stat_summary(fun=mean, aes(x= treatment, y = nitrogen),
               geom= "crossbar", width=0.6, colour= "black", data=avgnitrogent4)+
  geom_text(data=tukey_nitrogent4, aes(x=treatment, y = nitrogen, label= groups), color="black", nudge_x= 0.2, nudge_y= 0.01)+
  labs(title = "Differences in nitrogen T4.", 
       subtitle = "Three measures of each treatment", caption = "Anova p-value: 2.01e-05 (HSDTukey)", size = 10 )

plot_nitrogen_t4
```

### Differences between the beginning at the end of the experiment (T0 vs T4)


```{r stats orgmatter t0t4, include=TRUE}
soilt0t4 <- soil_prop %>% filter(time == "t0" | time == "t4") #data only t0 and t4

soil_t0t4_mean <- soilt0t4 %>% group_by(treatment,  time) %>% 
  summarise(across(.cols=everything(),.fns=list(mean = mean, sd = sd)),.groups = "drop")

shapiro.test(soilt0t4$org.matter) #no normal data
soilt0t4 %>% group_by(treatment) %>% shapiro_test(org.matter) # each treatments are normal 
ggqqplot(data = soilt0t4, "org.matter", facet.by = "treatment")
anova_orgt0t4 <- aov(org.matter ~ time + treatment, data=soilt0t4) #anova two ways
summary(anova_orgt0t4)
anova_orgt0t4int <- aov(org.matter ~ time * treatment , data=soilt0t4) #add rep= "block" To control for the effect of the differences between the 3 replicates # interaction between them?
summary(anova_orgt0t4int)
leveneTest(org.matter ~ time * treatment, data=soilt0t4) #equal variances 


orglm <- lm(org.matter~ time*treatment, data=soilt0t4)#model
anova(orglm)

emm_org <- emmeans(orglm, pairwise ~ time | treatment)
emm_org
emm_org$contrasts %>% rbind(adjust= "fdr") %>% summary(infer = TRUE)#el adjust es para el metodo de los pvalues

orgcontras <- data.frame(emm_org$contrasts)#data frame para sacar el valor del contraste 
orgcontras
orgemmeans <- data.frame(emm_org$emmeans) %>% group_by(treatment) %>% summarise(across(.cols= "emmean",.fns=mean),.groups = "drop")#para sacar el valor solo de emmeans
orgemmeans

emm_org <- cld(emmeans(orglm, specs = pairwise~treatment), Letters= letters, reversed= TRUE)#dif sig y las letras se lo indicas 
emm_org #tabla con los resultados. Se hacen dataframe para sacar las columnas que queremos y poder unirlas en los graficos 

pval.org.mat.time <- data.frame(treatment= orgcontras$treatment, pval= orgcontras$p.value, emmean= orgemmeans$emmean)
pval.org.mat.time
pval.org.mat.time$sign <- ifelse(pval.org.mat.time$pval>0.05, paste("ns"),
                                 ifelse(pval.org.mat.time$pval>0.01, paste("*"),
                                        ifelse(pval.org.mat.time$pval> 0.001,
                                               paste("**"), paste("***"))))#para add la significancia con el condicional ifelse


orgmattert0t4_time <- soil_t0t4_mean %>% ggplot(aes(x=factor(treatment, level= treat.order), y= org.matter_mean))+
  geom_col(aes(fill= time),position= "dodge")+
  xlab("")+
  ylab("oxidable organic matter (%)")+
  theme_classic2()+
  scale_x_discrete(labels= treat.labels)+
  geom_text(data = pval.org.mat.time, aes(x= treatment, y= emmean, label= sign), nudge_x= 0, nudge_y= 0.5)+
  geom_errorbar(data=soil_t0t4_mean, aes(ymin=org.matter_mean-org.matter_sd, 
                                            ymax=org.matter_mean+org.matter_sd, group= time), position=position_dodge(0.9),
                                            linewidth =0.2, width=0.2)

orgmattert0t4_time


#para hacer el delta, es decir cuanto ha variado la materia organica.. Hay que tener los archivos x separado  
mat.org.t0 <- subset(soilt0t4, soilt0t4$time == "t0")
mat.org.t0 <- data.frame( treatment=mat.org.t0$treatment, org.matter.t0= mat.org.t0$org.matter)
mat.org.t4 <- subset(soilt0t4, soilt0t4$time == "t4")
mat.org.t4 <- data.frame( treatment=mat.org.t4$treatment, org.matter.t4= mat.org.t4$org.matter)

delta.mat.org <- data.frame(treatment= mat.org.t0$treatment,t4= mat.org.t4$org.matter.t4 ,t0= mat.org.t0$org.matter.t0)
delta.mat.org$delta <- delta.mat.org$t4-delta.mat.org$t0
#delta.mat.org$ratio <- delta.mat.org$t4/delta.mat.org$t0
delta.mat.org

delta.org.lm <- lm(delta~ treatment, data=delta.mat.org)#model
anova(delta.org.lm)#p value 6.927e-06

emm_delta_org_lm <- emmeans(delta.org.lm, pairwise ~  treatment)
emm_delta_org_lm
emm_delta_org_lm$contrasts %>% rbind(adjust= "fdr") %>% summary(infer = TRUE)
emm_delta_org_lm <- cld(emmeans(delta.org.lm, specs = pairwise~treatment), Letters= letters, reversed= TRUE)
emm_delta_org_lm


plotdeltaorg <- delta.mat.org %>% ggplot(aes(x=factor(treatment, level= treat.order), y= delta, fill= treatment))+
  geom_point(pch= 23, size= 7)+
  xlab("")+
  ylab("Delta variation between t4-t0")+
  geom_hline(yintercept= 0, linetype = "dashed", color = "red")+
  scale_fill_manual(values= treat.colors)+
  geom_text(data= emm_delta_org_lm, aes(x= treatment, y= emmean, label= `.group`), nudge_x = 0.2, nudge_y = 0.2)+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()
plotdeltaorg


#unir los dos graficos
orgt0t4 <- ggarrange(orgmattert0t4_time, plotdeltaorg)

orgt0t4
```

```{r prueba, echo=FALSE}

```


```{r stas phosphorus t0t4, echo=FALSE}
shapiro.test(soilt0t4$phosphorus) #no normal data
soilt0t4 %>% group_by(treatment) %>% shapiro_test(phosphorus) # no normal data. the group of each data are normal in t0 and t4.
anova_phosphot0t4int <- aov(phosphorus ~ time * treatment, data=soilt0t4)# interaction between them
summary(anova_phosphot0t4int)
leveneTest(phosphorus ~ time * treatment, data=soilt0t4) #equal variances 
#model


phospholm <- lm(phosphorus ~ time*treatment, data=soilt0t4)#model
anova(phospholm)

emm_phospo <- emmeans(phospholm, pairwise ~ time | treatment)
emm_phospo
emm_phospo$contrasts %>% rbind(adjust= "fdr") %>% summary(infer = TRUE)#el adjust es para el metodo de los pvalues

phospocontras <- data.frame(emm_phospo$contrasts)#data frame para sacar el valor del contraste 
phospoemmeans <- data.frame(emm_phospo$emmeans) %>% group_by(treatment) %>% summarise(across(.cols= "emmean",.fns=mean),.groups = "drop")#para sacar el valor solo de emmeans
phospoemmeans

emm_phospo <- cld(emmeans(phospholm, specs = pairwise~treatment), Letters= letters, reversed= TRUE)
emm_phospo 

pval.phospo.time <- data.frame(treatment= phospocontras$treatment, pval= phospocontras$p.value, emmean= phospoemmeans)
pval.phospo.time
pval.phospo.time$sign <- ifelse(pval.phospo.time$pval>0.05, paste("ns"),
                                 ifelse(pval.phospo.time$pval>0.01, paste("*"),
                                        ifelse(pval.phospo.time$pval> 0.001,
                                               paste("**"), paste("***"))))#para add la significancia con el condicional ifelse


phospot0t4_time <- soil_t0t4_mean %>% ggplot(aes(x=factor(treatment, level= treat.order), y= phosphorus_mean))+
  geom_col(aes(fill= time),position= "dodge")+
  xlab("")+
  ylab("Phosphorus mg/kg")+
  theme_classic2()+
  scale_x_discrete(labels= treat.labels)+
  geom_text(data = pval.phospo.time, aes(x= treatment, y= emmean.emmean, label= sign), nudge_x= 0, nudge_y= 8)+
  geom_errorbar(data=soil_t0t4_mean, aes(ymin=phosphorus_mean-phosphorus_sd, 
                                            ymax=phosphorus_mean+phosphorus_sd, group= time), position=position_dodge(0.9),
                                            linewidth =0.2, width=0.2)

phospot0t4_time


#delta variation 
phosp.t0 <- subset(soilt0t4, soilt0t4$time == "t0")
phosp.t0 <- data.frame(treatment=phosp.t0$treatment, phospho.t0= phosp.t0$phosphorus)
phosp.t4 <- subset(soilt0t4, soilt0t4$time == "t4")
phosp.t4 <- data.frame(treatment=phosp.t4$treatment, phospho.t4= phosp.t4$phosphorus)

delta.phosp <- data.frame(treatment=phosp.t0$treatment,t4=phosp.t4$phospho.t4,t0=phosp.t0$phospho.t0)
delta.phosp$delta <- delta.mat.org$t4-delta.mat.org$t0

delta.phosp

delta.phosp.lm <- lm(delta~ treatment, data=delta.phosp)#model
anova(delta.phosp.lm )

emm.delta.phosp <- emmeans(delta.phosp.lm, pairwise ~  treatment)
emm.delta.phosp$contrasts %>% rbind(adjust= "fdr") %>% 
  summary(infer = TRUE)
emm.delta.phosp <- cld(emmeans(delta.phosp.lm, specs = pairwise~treatment), Letters= letters, reversed= TRUE)
emm.delta.phosp
emm.delta.phosp$.group#letras 

plotdeltapho <- delta.phosp %>% ggplot(aes(x=factor(treatment, level= treat.order), y= delta, fill= treatment))+
  geom_point(pch= 23, size= 7)+
  xlab("")+
  ylab("Delta variation between t4-t0")+
  geom_hline(yintercept= 0, linetype = "dashed", color = "red")+
  scale_fill_manual(values= treat.colors)+
  geom_text(data= emm.delta.phosp, aes(x= treatment, y= emmean, label= `.group`), nudge_x = 0.2, nudge_y = 0.2)+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()
plotdeltapho

phospot0t4 <- ggarrange(phospot0t4_time, plotdeltapho)


```




```{r stats ph water t0t4, echo=FALSE}
shapiro.test(soilt0t4$ph.water) #no normal data
soilt0t4 %>% group_by(treatment) %>% shapiro_test(ph.water) # each treatment are normal.
anova_phwatert0t4 <- aov(ph.water~ time + treatment, data=soilt0t4) #anova two ways
anova_phwatert0t4int <- aov(ph.water ~ time * treatment, data=soilt0t4) #add rep= "block" To control for the effect of the differences between the 3 replicates # interaction between them?
summary(anova_phwatert0t4int)
leveneTest(ph.water ~ time * treatment, data=soilt0t4) #equal variances p 0.48

ph_water_lm <- lm(ph.water ~ time*treatment, data=soilt0t4)#model
anova(ph_water_lm)

emm_ph_water <- emmeans(ph_water_lm, pairwise ~ time | treatment)
emm_ph_water
emm_ph_water$contrasts %>% rbind(adjust= "fdr") %>% summary(infer = TRUE)#el adjust es para el metodo de los pvalues

ph_watercontras <- data.frame(emm_ph_water$contrasts)#data frame para sacar el valor del contraste 
ph_wateremmeans <- data.frame(emm_ph_water$emmeans) %>% group_by(treatment) %>% summarise(across(.cols= "emmean",.fns=mean),.groups = "drop")#para sacar el valor solo de emmeans
ph_wateremmeans

emm_ph_water <- cld(emmeans(ph_water_lm, specs = pairwise~treatment), Letters= letters, reversed= TRUE)
emm_ph_water 

pval.ph_water.time <- data.frame(treatment= ph_watercontras$treatment, pval= ph_watercontras$p.value, emmean= ph_wateremmeans)
pval.ph_water.time
pval.ph_water.time$sign <- ifelse(pval.ph_water.time$pval>0.05, paste("ns"),
                                 ifelse(pval.ph_water.time$pval>0.01, paste("*"),
                                        ifelse(pval.ph_water.time$pval> 0.001,
                                               paste("**"), paste("***"))))#para add la significancia con el condicional ifelse


ph_watert0t4_time <- soil_t0t4_mean %>% ggplot(aes(x=factor(treatment, level= treat.order), y= ph.water_mean))+
  geom_col(aes(fill= time),position= "dodge")+
  xlab("")+
  ylab("pH water udes.")+
  theme_classic2()+
  scale_x_discrete(labels= treat.labels)+
  geom_text(data = pval.ph_water.time, aes(x= treatment, y= emmean.emmean, label= sign), nudge_x= 0, nudge_y= 0.5)+
  geom_errorbar(data=soil_t0t4_mean, aes(ymin=ph.water_mean-ph.water_sd, 
                                            ymax=ph.water_mean+ph.water_sd, group= time), position=position_dodge(0.9),
                                            linewidth =0.2, width=0.2)

ph_watert0t4_time


#delta variation 
ph_water.t0 <- subset(soilt0t4, soilt0t4$time == "t0")
ph_water.t0 <- data.frame(treatment=ph_water.t0$treatment, ph_water.t0= ph_water.t0$ph.water)
ph_water.t4 <- subset(soilt0t4, soilt0t4$time == "t4")
ph_water.t4 <- data.frame(treatment=ph_water.t4$treatment, ph_water.t4= ph_water.t4$ph.water)

delta.ph_water <- data.frame(treatment=ph_water.t0$treatment,t4=ph_water.t4$ph_water.t4,t0=ph_water.t0$ph_water.t0)
delta.ph_water$delta <- delta.ph_water$t4-delta.ph_water$t0

delta.ph_water

delta.ph_water.lm <- lm(delta~ treatment, data=delta.ph_water)#model
anova(delta.ph_water.lm )

emm.delta.ph_water <- emmeans(delta.ph_water.lm, pairwise ~  treatment)
emm.delta.ph_water$contrasts %>% rbind(adjust= "fdr") %>% 
  summary(infer = TRUE)
emm.delta.ph_water <- cld(emmeans(delta.ph_water.lm, specs = pairwise~treatment), Letters= letters, reversed= TRUE)
emm.delta.ph_water
emm.delta.ph_water$.group#letras 

plotdeltaphwater <- delta.ph_water %>% ggplot(aes(x=factor(treatment, level= treat.order), y= delta, fill= treatment))+
  geom_point(pch= 23, size= 7)+
  xlab("")+
  ylab("Delta variation between t4-t0")+
  geom_hline(yintercept= 0, linetype = "dashed", color = "red")+
  scale_fill_manual(values= treat.colors)+
  geom_text(data= emm.delta.ph_water, aes(x= treatment, y= emmean, label= `.group`), nudge_x = 0.2, nudge_y = 0.2)+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()
plotdeltaphwater

ph_watert0t4 <- ggarrange(ph_watert0t4_time, plotdeltaphwater)
ph_watert0t4
```

```{r stats conductivity t0t4, echo=FALSE}
shapiro.test(soilt0t4$conductivity) #no normal data
soilt0t4 %>% group_by(treatment) %>% shapiro_test(conductivity) # each treatment are normal.
anova_conduct0t4 <- aov(conductivity~ time + treatment, data=soilt0t4) #anova two ways
summary(anova_conduct0t4)
anova_conduct0t4int <- aov(conductivity ~ time * treatment, data=soilt0t4) #add rep= "block" To control for the effect of the differences between the 3 replicates # interaction between them?
summary(anova_conduct0t4int)
leveneTest(conductivity ~ time * treatment, data=soilt0t4) #equal variances p 0.07068

conduct_lm <- lm(conductivity ~ time*treatment, data=soilt0t4)#model
anova(conduct_lm)

emm_conduct <- emmeans(conduct_lm, pairwise ~ time | treatment)
emm_conduct
emm_conduct$contrasts %>% rbind(adjust= "fdr") %>% summary(infer = TRUE)#el adjust es para el metodo de los pvalues

conductcontras <- data.frame(emm_conduct$contrasts)#data frame para sacar el valor del contraste 
conductemmeans <- data.frame(emm_conduct$emmeans) %>% group_by(treatment) %>% summarise(across(.cols= "emmean",.fns=mean),.groups = "drop")#para sacar el valor solo de emmeans
conductemmeans

emm_conduct <- cld(emmeans(conduct_lm, specs = pairwise~treatment), Letters= letters, reversed= TRUE)
emm_conduct 

pval.conduct.time <- data.frame(treatment= conductcontras$treatment, pval= conductcontras$p.value, emmean= conductemmeans)
pval.conduct.time
pval.conduct.time$sign <- ifelse(pval.conduct.time$pval>0.05, paste("ns"),
                                 ifelse(pval.conduct.time$pval>0.01, paste("*"),
                                        ifelse(pval.conduct.time$pval> 0.001,
                                               paste("**"), paste("***"))))#para add la significancia con el condicional ifelse


conductt0t4_time <- soil_t0t4_mean %>% ggplot(aes(x=factor(treatment, level= treat.order), y= conductivity_mean))+
  geom_col(aes(fill= time),position= "dodge")+
  xlab("")+
  ylab("conductivity mS/cm.")+
  theme_classic2()+
  scale_x_discrete(labels= treat.labels)+
  geom_text(data = pval.conduct.time, aes(x= treatment, y= emmean.emmean, label= sign), nudge_x= 0, nudge_y= 0.2)+
  geom_errorbar(data=soil_t0t4_mean, aes(ymin=conductivity_mean-conductivity_sd, ymax=conductivity_mean+conductivity_sd,
                                         group= time), position=position_dodge(0.9),
                                        linewidth =0.2, width=0.2)

conductt0t4_time
#delta variation 
conduct.t0 <- subset(soilt0t4, soilt0t4$time == "t0")
conduct.t0
conduct.t0 <- data.frame(treatment=conduct.t0$treatment, conduct.t0= conduct.t0$conductivity)
conduct.t4 <- subset(soilt0t4, soilt0t4$time == "t4")
conduct.t4 <- data.frame(treatment=conduct.t4$treatment, conduct.t4= conduct.t4$conductivity)

delta.conduct <- data.frame(treatment=conduct.t0$treatment,t4=conduct.t4$conduct.t4,t0=conduct.t0$conduct.t0)
delta.conduct$delta <- delta.conduct$t4-delta.conduct$t0

delta.conduct

delta.conduct.lm <- lm(delta~ treatment, data=delta.conduct)#model
anova(delta.conduct.lm )

emm.delta.conduct <- emmeans(delta.conduct.lm, pairwise ~  treatment)
emm.delta.conduct$contrasts %>% rbind(adjust= "fdr") %>% 
  summary(infer = TRUE)
emm.delta.conduct <- cld(emmeans(delta.conduct.lm, specs = pairwise~treatment), Letters= letters, reversed= TRUE)
emm.delta.conduct
emm.delta.conduct$.group#letras 

plotdelta_conduc <- delta.conduct %>% ggplot(aes(x=factor(treatment, level= treat.order), y= delta, fill= treatment))+
  geom_point(pch= 23, size= 7)+
  xlab("")+
  ylab("Delta variation between t4-t0")+
  geom_hline(yintercept= 0, linetype = "dashed", color = "red")+
  scale_fill_manual(values= treat.colors)+
  geom_text(data= emm.delta.conduct, aes(x= treatment, y= emmean, label= `.group`), nudge_x = 0.2, nudge_y = 0.2)+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()
plotdelta_conduc

conductt0t4 <- ggarrange(conductt0t4_time, plotdelta_conduc)
conductt0t4

```


```{r stas calcium t0t4, echo=FALSE}
shapiro.test(soilt0t4$calcium) # normal data
anova_calciumt0t4 <- aov(calcium~ time + treatment, data=soilt0t4) #anova two ways
summary(anova_calciumt0t4)
anova_calciumt0t4int <- aov(calcium ~ time * treatment + rep, data=soilt0t4) #add rep= "block" To control for the effect of the differences between the 3 replicates # interaction between them?
summary(anova_calciumt0t4int)
leveneTest(calcium ~ time * treatment, data=soilt0t4) #equal variances
calcium_lm <- lm(calcium ~ time*treatment, data=soilt0t4)#model
anova(calcium_lm)

emm_calcium <- emmeans(calcium_lm, pairwise ~ time | treatment)
emm_calcium
emm_calcium$contrasts %>% rbind(adjust= "fdr") %>% summary(infer = TRUE)#el adjust es para el metodo de los pvalues

calciumcontras <- data.frame(emm_calcium$contrasts)#data frame para sacar el valor del contraste 
calciumemmeans <- data.frame(emm_calcium$emmeans) %>% group_by(treatment) %>% summarise(across(.cols= "emmean",.fns=mean),.groups = "drop")#para sacar el valor solo de emmeans
calciumemmeans

emm_calcium <- cld(emmeans(calcium_lm, specs = pairwise~treatment), Letters= letters, reversed= TRUE)
emm_calcium 

pval.calcium.time <- data.frame(treatment= calciumcontras$treatment, pval= calciumcontras$p.value, emmean= calciumemmeans)
pval.calcium.time
pval.calcium.time$sign <- ifelse(pval.calcium.time$pval>0.05, paste("ns"),
                                 ifelse(pval.calcium.time$pval>0.01, paste("*"),
                                        ifelse(pval.calcium.time$pval> 0.001,
                                               paste("**"), paste("***"))))#para add la significancia con el condicional ifelse


calciumt0t4_time <- soil_t0t4_mean %>% ggplot(aes(x=factor(treatment, level= treat.order), y= calcium_mean))+
  geom_col(aes(fill= time),position= "dodge")+
  xlab("")+
  ylab("calcium mEq/kg.")+
  theme_classic2()+
  scale_x_discrete(labels= treat.labels)+
  geom_text(data = pval.calcium.time, aes(x= treatment, y= emmean.emmean, label= sign), nudge_x= 0, nudge_y= 10)+
  geom_errorbar(data=soil_t0t4_mean, aes(ymin=calcium_mean-calcium_sd, ymax=calcium_mean+calcium_sd,
                                         group= time), position=position_dodge(0.9),
                                        linewidth =0.2, width=0.2)

calciumt0t4_time
#delta variation 
calcium.t0 <- subset(soilt0t4, soilt0t4$time == "t0")
calcium.t0 <- data.frame(treatment=calcium.t0$treatment, calcium.t0= calcium.t0$calcium)
calcium.t4 <- subset(soilt0t4, soilt0t4$time == "t4")
calcium.t4 <- data.frame(treatment=calcium.t4$treatment, calcium.t4= calcium.t4$calcium)

delta.calcium <- data.frame(treatment=calcium.t0$treatment,t4=calcium.t4$calcium.t4,t0=calcium.t0$calcium.t0)
delta.calcium$delta <- delta.calcium$t4-delta.calcium$t0

delta.calcium

delta.calcium.lm <- lm(delta~ treatment, data=delta.calcium)#model
anova(delta.calcium.lm )

emm.delta.calcium <- emmeans(delta.calcium.lm, pairwise ~  treatment)
emm.delta.calcium$contrasts %>% rbind(adjust= "fdr") %>% 
  summary(infer = TRUE)

emm.delta.calcium <- cld(emmeans(delta.calcium.lm, specs = pairwise~treatment), Letters= letters, reversed= TRUE)
emm.delta.calcium
emm.delta.calcium$.group#letras 

plotdelta_calcium <- delta.calcium %>% ggplot(aes(x=factor(treatment, level= treat.order), y= delta, fill= treatment))+
  geom_point(pch= 23, size= 7)+
  xlab("")+
  ylab("Delta variation between t4-t0")+
  geom_hline(yintercept= 0, linetype = "dashed", color = "red")+
  scale_fill_manual(values= treat.colors)+
  geom_text(data= emm.delta.calcium, aes(x= treatment, y= emmean, label= `.group`), nudge_x = 0.2, nudge_y = 0.2)+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()
plotdelta_calcium

calciumt0t4 <- ggarrange(calciumt0t4_time, plotdelta_calcium)
calciumt0t4

```

```{r stats sodium t0t4, echo=FALSE}
shapiro.test(soilt0t4$sodium) # no normal data
soilt0t4 %>% group_by(treatment) %>% shapiro_test(sodium) # each treatment are normal in the different times. 
anova_sodiumt0t4 <- aov(sodium~ time + treatment, data=soilt0t4) #anova two ways
summary(anova_sodiumt0t4)
anova_sodiumt0t4int <- aov(sodium ~ time * treatment + rep, data=soilt0t4) #add rep= "block" To control for the effect of the differences between the 3 replicates # interaction between them?
summary(anova_sodiumt0t4int)
leveneTest(sodium ~ time * treatment, data=soilt0t4) #equal variances p 0.48

sodium_lm <- lm(sodium ~ time*treatment, data=soilt0t4)#model
anova(sodium_lm)

emm_sodium <- emmeans(sodium_lm, pairwise ~ time | treatment)
emm_sodium
emm_sodium$contrasts %>% rbind(adjust= "fdr") %>% summary(infer = TRUE)#el adjust es para el metodo de los pvalues

sodiumcontras <- data.frame(emm_sodium$contrasts)#data frame para sacar el valor del contraste 
sodiumemmeans <- data.frame(emm_sodium$emmeans) %>% group_by(treatment) %>% summarise(across(.cols= "emmean",.fns=mean),.groups = "drop")#para sacar el valor solo de emmeans
sodiumemmeans

emm_sodium <- cld(emmeans(sodium_lm, specs = pairwise~treatment), Letters= letters, reversed= TRUE)
emm_sodium 

pval.sodium.time <- data.frame(treatment= sodiumcontras$treatment, pval= sodiumcontras$p.value, emmean= sodiumemmeans)
pval.sodium.time
pval.sodium.time$sign <- ifelse(pval.sodium.time$pval>0.05, paste("ns"),
                                 ifelse(pval.sodium.time$pval>0.01, paste("*"),
                                        ifelse(pval.sodium.time$pval> 0.001,
                                               paste("**"), paste("***"))))#para add la significancia con el condicional ifelse


sodiumt0t4_time <- soil_t0t4_mean %>% ggplot(aes(x=factor(treatment, level= treat.order), y= sodium_mean))+
  geom_col(aes(fill= time),position= "dodge")+
  xlab("")+
  ylab("Sodium mEq/kg.")+
  theme_classic2()+
  scale_x_discrete(labels= treat.labels)+
  geom_text(data = pval.sodium.time, aes(x= treatment, y= emmean.emmean, label= sign), nudge_x= 0, nudge_y= 10)+
  geom_errorbar(data=soil_t0t4_mean, aes(ymin=sodium_mean-sodium_sd, ymax=sodium_mean+sodium_sd,
                                         group= time), position=position_dodge(0.9),
                                        linewidth =0.2, width=0.2)

sodiumt0t4_time
#delta variation 
sodium.t0 <- subset(soilt0t4, soilt0t4$time == "t0")
sodium.t0 <- data.frame(treatment=sodium.t0$treatment, sodium.t0= sodium.t0$sodium)
sodium.t4 <- subset(soilt0t4, soilt0t4$time == "t4")
sodium.t4 <- data.frame(treatment=sodium.t4$treatment, sodium.t4= sodium.t4$sodium)

delta.sodium <- data.frame(treatment=sodium.t0$treatment,t4=sodium.t4$sodium.t4,t0=sodium.t0$sodium.t0)
delta.sodium$delta <- delta.sodium$t4-delta.sodium$t0

delta.sodium

delta.sodium.lm <- lm(delta~ treatment, data=delta.sodium)#model
anova(delta.sodium.lm )

emm.delta.sodium <- emmeans(delta.sodium.lm, pairwise ~  treatment)
emm.delta.sodium$contrasts %>% rbind(adjust= "fdr") %>% 
  summary(infer = TRUE)

emm.delta.sodium <- cld(emmeans(delta.sodium.lm, specs = pairwise~treatment), Letters= letters, reversed= TRUE)
emm.delta.sodium
emm.delta.sodium$.group#letras 

plotdelta_sodium <- delta.sodium %>% ggplot(aes(x=factor(treatment, level= treat.order), y= delta, fill= treatment))+
  geom_point(pch= 23, size= 7)+
  xlab("")+
  ylab("Delta variation between t4-t0")+
  geom_hline(yintercept= 0, linetype = "dashed", color = "red")+
  scale_fill_manual(values= treat.colors)+
  geom_text(data= emm.delta.sodium, aes(x= treatment, y= emmean, label= `.group`), nudge_x = 0.2, nudge_y = 0.2)+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()
plotdelta_sodium

sodiumt0t4 <- ggarrange(sodiumt0t4_time, plotdelta_sodium)
sodiumt0t4
```

```{r stats potassium t0t4, echo=FALSE}
shapiro.test(soilt0t4$potassium) #normal data
anova_potassiumt0t4 <- aov(potassium~ time + treatment, data=soilt0t4) #anova two ways
summary(anova_potassiumt0t4)
anova_potassiumt0t4int <- aov(potassium ~ time * treatment + rep, data=soilt0t4) #add rep= "block" To control for the effect of the differences between the 3 replicates # interaction between them?
summary(anova_potassiumt0t4int)
leveneTest(potassium ~ time * treatment, data=soilt0t4) #equal variances

potassium_lm <- lm(potassium ~ time*treatment, data=soilt0t4)#model
anova(potassium_lm)

emm_potassium <- emmeans(potassium_lm, pairwise ~ time | treatment)
emm_potassium
emm_potassium$contrasts %>% rbind(adjust= "fdr") %>% summary(infer = TRUE)#el adjust es para el metodo de los pvalues

potassiumcontras <- data.frame(emm_potassium$contrasts)#data frame para sacar el valor del contraste 
potassiumemmeans <- data.frame(emm_potassium$emmeans) %>% group_by(treatment) %>% summarise(across(.cols= "emmean",.fns=mean),.groups = "drop")#para sacar el valor solo de emmeans
potassiumemmeans

emm_potassium <- cld(emmeans(potassium_lm, specs = pairwise~treatment), Letters= letters, reversed= TRUE)
emm_potassium 

pval.potassium.time <- data.frame(treatment= potassiumcontras$treatment, pval= potassiumcontras$p.value, emmean= potassiumemmeans)
pval.potassium.time
pval.potassium.time$sign <- ifelse(pval.potassium.time$pval>0.05, paste("ns"),
                                 ifelse(pval.potassium.time$pval>0.01, paste("*"),
                                        ifelse(pval.potassium.time$pval> 0.001,
                                               paste("**"), paste("***"))))#para add la significancia con el condicional ifelse


potassiumt0t4_time <- soil_t0t4_mean %>% ggplot(aes(x=factor(treatment, level= treat.order), y= potassium_mean))+
  geom_col(aes(fill= time),position= "dodge")+
  xlab("")+
  ylab("potassium mEq/kg.")+
  theme_classic2()+
  scale_x_discrete(labels= treat.labels)+
  geom_text(data = pval.potassium.time, aes(x= treatment, y= emmean.emmean, label= sign), nudge_x= 0, nudge_y= 1)+
  geom_errorbar(data=soil_t0t4_mean, aes(ymin=potassium_mean-potassium_sd, ymax=potassium_mean+potassium_sd,
                                         group= time), position=position_dodge(0.9),
                                        linewidth =0.2, width=0.2)

potassiumt0t4_time
#delta variation 
potassium.t0 <- subset(soilt0t4, soilt0t4$time == "t0")
potassium.t0 <- data.frame(treatment=potassium.t0$treatment, potassium.t0= potassium.t0$potassium)
potassium.t4 <- subset(soilt0t4, soilt0t4$time == "t4")
potassium.t4 <- data.frame(treatment=potassium.t4$treatment, potassium.t4= potassium.t4$potassium)

delta.potassium <- data.frame(treatment=potassium.t0$treatment,t4=potassium.t4$potassium.t4,t0=potassium.t0$potassium.t0)
delta.potassium$delta <- delta.potassium$t4-delta.potassium$t0

delta.potassium

delta.potassium.lm <- lm(delta~ treatment, data=delta.potassium)#model
anova(delta.potassium.lm )

emm.delta.potassium <- emmeans(delta.potassium.lm, pairwise ~  treatment)
emm.delta.potassium$contrasts %>% rbind(adjust= "fdr") %>% 
  summary(infer = TRUE)

emm.delta.potassium <- cld(emmeans(delta.potassium.lm, specs = pairwise~treatment), Letters= letters, reversed= TRUE)
emm.delta.potassium
emm.delta.potassium$.group#letras 

plotdelta_potassium <- delta.potassium %>% ggplot(aes(x=factor(treatment, level= treat.order), y= delta, fill= treatment))+
  geom_point(pch= 23, size= 7)+
  xlab("")+
  ylab("Delta variation between t4-t0")+
  geom_hline(yintercept= 0, linetype = "dashed", color = "red")+
  scale_fill_manual(values= treat.colors)+
  geom_text(data= emm.delta.potassium, aes(x= treatment, y= emmean, label= `.group`), nudge_x = 0.2, nudge_y = 0.2)+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()
plotdelta_potassium

potassiumt0t4 <- ggarrange(potassiumt0t4_time, plotdelta_potassium)
potassiumt0t4


```


```{r stats nitrogen t0t4, echo=FALSE}
shapiro.test(soilt0t4$nitrogen) #normal data
anova_nitrogent0t4 <- aov(nitrogen~ time + treatment, data=soilt0t4) #anova two ways
summary(anova_nitrogent0t4)
anova_nitrogent0t4int <- aov(nitrogen ~ time * treatment + rep, data=soilt0t4) #add rep= "block" To control for the effect of the differences between the 3 replicates # interaction between them?
summary(anova_nitrogent0t4int)
leveneTest(nitrogen ~ time * treatment, data=soilt0t4) #equal variances
nitrogen_lm <- lm(nitrogen ~ time*treatment, data=soilt0t4)#model
anova(nitrogen_lm)

emm_nitrogen <- emmeans(nitrogen_lm, pairwise ~ time | treatment)
emm_nitrogen
emm_nitrogen$contrasts %>% rbind(adjust= "fdr") %>% summary(infer = TRUE)#el adjust es para el metodo de los pvalues

nitrogencontras <- data.frame(emm_nitrogen$contrasts)#data frame para sacar el valor del contraste 
nitrogenemmeans <- data.frame(emm_nitrogen$emmeans) %>% group_by(treatment) %>% summarise(across(.cols= "emmean",.fns=mean),.groups = "drop")#para sacar el valor solo de emmeans
nitrogenemmeans

emm_nitrogen <- cld(emmeans(nitrogen_lm, specs = pairwise~treatment), Letters= letters, reversed= TRUE)
emm_nitrogen 

pval.nitrogen.time <- data.frame(treatment= nitrogencontras$treatment, pval= nitrogencontras$p.value, emmean= nitrogenemmeans)
pval.nitrogen.time
pval.nitrogen.time$sign <- ifelse(pval.nitrogen.time$pval>0.05, paste("ns"),
                                 ifelse(pval.nitrogen.time$pval>0.01, paste("*"),
                                        ifelse(pval.nitrogen.time$pval> 0.001,
                                               paste("**"), paste("***"))))#para add la significancia con el condicional ifelse


nitrogent0t4_time <- soil_t0t4_mean %>% ggplot(aes(x=factor(treatment, level= treat.order), y= nitrogen_mean))+
  geom_col(aes(fill= time),position= "dodge")+
  xlab("")+
  ylab("nitrogen (%).")+
  theme_classic2()+
  scale_x_discrete(labels= treat.labels)+
  geom_text(data = pval.nitrogen.time, aes(x= treatment, y= emmean.emmean, label= sign), nudge_x= 0, nudge_y= 0.02)+
  geom_errorbar(data=soil_t0t4_mean, aes(ymin=nitrogen_mean-nitrogen_sd, ymax=nitrogen_mean+nitrogen_sd,
                                         group= time), position=position_dodge(0.9),
                                        linewidth =0.2, width=0.2)

nitrogent0t4_time
#delta variation 
nitrogen.t0 <- subset(soilt0t4, soilt0t4$time == "t0")
nitrogen.t0 <- data.frame(treatment=nitrogen.t0$treatment, nitrogen.t0= nitrogen.t0$nitrogen)
nitrogen.t4 <- subset(soilt0t4, soilt0t4$time == "t4")
nitrogen.t4 <- data.frame(treatment=nitrogen.t4$treatment, nitrogen.t4= nitrogen.t4$nitrogen)

delta.nitrogen <- data.frame(treatment=nitrogen.t0$treatment,t4=nitrogen.t4$nitrogen.t4,t0=nitrogen.t0$nitrogen.t0)
delta.nitrogen$delta <- delta.nitrogen$t4-delta.nitrogen$t0

delta.nitrogen

delta.nitrogen.lm <- lm(delta~ treatment, data=delta.nitrogen)#model
anova(delta.nitrogen.lm )

emm.delta.nitrogen <- emmeans(delta.nitrogen.lm, pairwise ~  treatment)
emm.delta.nitrogen$contrasts %>% rbind(adjust= "fdr") %>% 
  summary(infer = TRUE)

emm.delta.nitrogen <- cld(emmeans(delta.nitrogen.lm, specs = pairwise~treatment), Letters= letters, reversed= TRUE)
emm.delta.nitrogen
emm.delta.nitrogen$.group#letras 

plotdelta_nitrogen <- delta.nitrogen %>% ggplot(aes(x=factor(treatment, level= treat.order), y= delta, fill= treatment))+
  geom_point(pch= 23, size= 7)+
  xlab("")+
  ylab("Delta variation between t4-t0")+
  geom_hline(yintercept= 0, linetype = "dashed", color = "red")+
  scale_fill_manual(values= treat.colors)+
  geom_text(data= emm.delta.nitrogen, aes(x= treatment, y= emmean, label= `.group`), nudge_x = 0.2, nudge_y = 0)+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()
plotdelta_nitrogen

nitrogent0t4 <- ggarrange(nitrogent0t4_time, plotdelta_nitrogen)
nitrogent0t4


```

