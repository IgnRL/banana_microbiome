---
title: "Soil respiration. Banana project"
author: "Raquel Correa"
date: "2023-10-24"
output: html_document
---

```{r library, include=FALSE}
library(ggplot2)
library(tidyverse)
library(ggpubr)
library(gridExtra)
library(corrplot)
library(agricolae)
library(emmeans)
library(multcomp)
library(multcompView)
library(data.table)
library(tidyverse)
library(phyloseq)
library(vegan)
library(ape)
library(here)
library(readxl)
library(ggpubr)
library(geomtextpath)
library(knitr)
library(gridExtra)
library(Biostrings)
library(seqinr)
library(FSA)
library(agricolae)
library(MASS)
library(grid)
library(gridExtra)
library(emmeans)
library(multcomp)
library(broom)
library(viridis)
library(ALDEx2)
library(FactoMineR)
library(factoextra)
library(kableExtra)
library(scales)
library(dunn.test)
library(car)
library(corrplot)
library(eulerr)
library(ggforce)
library(ggrepel)
library(rstatix)
library(AICcmodavg)
library(ggthemes)

```


```{r banana colours, include=FALSE}
treat.colors <- c("control"= "green4" ,"control.amf"  = "darkseagreen" , "chicken.manure"= "royalblue1", "cow.manure" = "red3","mo.pellet"= "darkorchid1","compost"="chocolate4","control.legume"="darkolivegreen4")

treat.order <- c('control', 'control.amf', 'control.legume', "compost", "chicken.manure", "cow.manure", "mo.pellet") 
treat.labels <- c("Control", "Control\nAMF", "Control\nLegume", "Compost", "Chicken\nmanure", "Cow\nmanure", "Pellet")

```


```{r soil respiration, include=FALSE}
soil_resp <- readxl::read_excel("C:/Users/raquel.correa/Documents/banana_microbiome/raw_files/soil_respiration.xlsx")

soil_resp_mean <- soil_resp %>% group_by(treatment,  time) %>% 
  summarise(across(.cols=everything(),.fns=list(mean = mean, sd = sd)),.groups = "drop")


soil_resp_mean
```

### Evolution of soil respiration over time 
One way to measure the microbial community of a soil is respiration. Check how much CO2 is released from it.

A) Basal respiration: The falcon tubes (50 ml), with the original soil samples, were placed in jars with
hermetic closure. The evaluation of respiration (CO2 production) was carried out by titration of the
sodium hydroxide (0.5 M) with hydrochloric acid (0.5 M) once the sample has been incubated for 7 days at 25ºC.


B) Induced respiration: Induced respiration was carried out once basal respiration had been evaluated (that is, on the same samples). A solution is added of 20% sterile glucose (0.5 ml/sample). Subsequently, the samples were incubated at 25ºC for
2.5 days and the sodium hydroxide (0.5 M) was titrated with hydrochloric acid (0.5 M).

```{r over the time, echo=FALSE}
basal_plotsd <- soil_resp_mean%>% ggplot(aes(x=time, group= treatment, col= treatment, y=mg_co_basal_mean))+
  geom_line(linewidth=1)+
  theme_classic2()+
  xlab("Time")+
  ylab("mg C-CO2/kg dry soil")+
  scale_color_manual(values= treat.colors)+
  geom_point()+
  geom_errorbar(aes(ymin=mg_co_basal_mean-mg_co_basal_sd,   ymax=mg_co_basal_mean+mg_co_basal_sd), size =0.5, width=0.2)+
  labs(title = "Basal respiration.", subtitle = "", caption="Mean and SD")+
  theme(plot.title = element_text(size=12))
basal_plotsd

ggsave(basal_plotsd, file="soil_respiration_result/basal_duringtime.png", width= 1900,height= 1200, units= "px")

induced_plotsd <- soil_resp_mean%>% ggplot(aes(x=time, group= treatment, col= treatment, y=mg_co_induced_mean))+
  geom_line(linewidth=1)+
  theme_classic2()+
  xlab("Time")+
  ylab("mg C-CO2/kg dry soil")+
  scale_color_manual(values= treat.colors)+
  geom_point()+
  geom_errorbar(aes(ymin=mg_co_induced_mean-mg_co_induced_sd,   ymax=mg_co_induced_mean+mg_co_induced_sd), width=0.2)+
  labs(title = "Induced respiration.", subtitle = "", caption="Mean and SD")+
  theme(plot.title = element_text(size=12))
induced_plotsd
ggsave(induced_plotsd, file="soil _respiration_result/induced_duringtime.png", width= 1900,height= 1200, units= "px")

respirationplot <- ggarrange (basal_plotsd, induced_plotsd,
                              common.legend = TRUE, legend = "bottom", 
                              labels = c("A", "B"), 
                              font.label = list (size = 10, color= "black"))

respirationplot
ggsave(respirationplot, file="soil_respiration_result/respiration_duringtime.png", width= 1900,height= 1200, units= "px")

respiration_inducedplot2 <- soil_resp_mean%>% ggplot(aes(x=time, group= treatment, fill= treatment, y=mg_co_induced_mean))+
  geom_col(aes(fill= treatment), position= "dodge")+
  scale_fill_manual(values= treat.colors)+
  labs(title = "Induced respiration.", subtitle = "", caption="Mean")+
  theme_classic()

respiration_inducedplot2

respiration_basdalplot2 <- soil_resp_mean%>% ggplot(aes(x=time, group= treatment, fill= treatment, y=mg_co_basal_mean))+
  geom_col(aes(fill= treatment), position= "dodge")+
  scale_fill_manual(values= treat.colors)+
  labs(title = "Basal respiration.", subtitle = "", caption="Mean")+
  theme_classic()
respiration_basdalplot2


respiration_columplot <- ggarrange (respiration_basdalplot2, respiration_inducedplot2,
                              common.legend = TRUE, legend = "bottom", 
                              labels = c("A", "B"), 
                              font.label = list (size = 10, color= "black"))
respiration_columplot
ggsave(respiration_columplot, file="soil_respiration_result/respirationcolum_duringtime.png", width= 1900,height= 1200, units= "px")

```

### Differences of respiration between treatments at the start of the experiment (t0)

```{r respiration basal and induced t0, echo=FALSE}

respirationt0 <- subset(soil_resp, soil_resp$time == "t0")
#analized basal
shapiro.test(respirationt0$mg_co_basal)#data basal normal
leveneTest(mg_co_basal~ treatment, data=respirationt0) #equal Variance 

anova_basalt0 <- aov(mg_co_basal ~ treatment, data=respirationt0) #signification different 
summary(anova_basalt0)
tukey_basalt0 <- HSD.test(anova_basalt0, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
tukey_basalt0

meanbasalt0 <- aggregate(mg_co_basal ~ treatment, data=respirationt0, FUN= mean)

plot_basal_t0 <- respirationt0 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= mg_co_basal, col=treatment, group=treatment))+
  geom_point(size=9)+
  scale_color_manual(values= treat.colors)+
  xlab("Treatments")+
  ylab("mg C-CO2/kg dry soil")+#basal
  stat_summary(fun=mean, aes(x= treatment, y = mg_co_basal),
               geom= "crossbar", colour= "black", width= 0.7, data=meanbasalt0)+
  geom_text(data=tukey_basalt0, aes(x=treatment, y = mg_co_basal, label= groups), 
            size= 4, colour="black", fontface = "bold", nudge_x= 0.2, nudge_y= 0.6)+
  labs(title = "Basal respiration at T0.", subtitle = "" , caption = "HSDTukey p-value")+
  theme(plot.title = element_text(size=1))+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()
plot_basal_t0
ggsave(plot_basal_t0, file="soil_respiration_result/dif_basal_t0.png", width= 1900,height= 1200, units= "px")

#analized induced
shapiro.test(respirationt0$mg_co_induced)#data induced no normal
soil_resp %>% group_by(treatment) %>% shapiro_test(mg_co_induced) #all data of each time of induced are normal
leveneTest(mg_co_induced~ treatment, data=respirationt0) #equal variance
anova_inducedt0 <- aov(mg_co_induced ~ treatment, data=respirationt0) #signification different 
summary(anova_inducedt0)
tukey_inducedt0 <- HSD.test(anova_inducedt0, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
tukey_inducedt0

meaninducedt0 <- aggregate(mg_co_induced ~ treatment, data=respirationt0, FUN= mean)

plot_induced_t0 <- respirationt0 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= mg_co_induced, col=treatment, group=treatment))+
  geom_point(size=9)+
  scale_color_manual(values= treat.colors)+
  xlab("Treatments")+
  ylab("mg C-CO2/kg dry soil")+#induced
  stat_summary(fun=mean, aes(x= treatment, y = mg_co_induced),
               geom= "crossbar", colour= "black", width= 0.7, data=meaninducedt0)+
  geom_text(data=tukey_inducedt0, aes(x=treatment, y = mg_co_induced, label= groups), 
            size= 4, colour="black", fontface = "bold", nudge_x= 0.2, nudge_y= 4.5)+
  labs(title = "Induced respiration at T0.", subtitle = "" , caption = "HSDTukey p-value")+
  theme(plot.title = element_text(size=1))+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()
plot_induced_t0
ggsave(plot_induced_t0, file="soil_respiration_result/dif_induced_t0.png", width= 1900,height= 1200, units= "px")
basal_induced_t0 <- ggarrange(plot_basal_t0,plot_induced_t0,
                              ncol=2,
                              common.legend = TRUE, legend = "none", 
                              labels = c("A", "B"),
                              font.label = list (size = 10, color= "black"))
basal_induced_t0
ggsave(basal_induced_t0, file="soil_respiration_result/dif_basal_induced_t0.png", width= 1900,height= 1200, units= "px")
```

### Differences of respiration between treatments at T1


```{r respiration basal and induced t1, echo=FALSE}

respirationt1 <- subset(soil_resp, soil_resp$time == "t1")
#analized basal
shapiro.test(respirationt1$mg_co_basal)#data basal normal
leveneTest(mg_co_basal~ treatment, data=respirationt0) #equal Variance 

anova_basalt1 <- aov(mg_co_basal ~ treatment, data=respirationt1) #signification different 
summary(anova_basalt1)
tukey_basalt1 <- HSD.test(anova_basalt1, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
tukey_basalt1

meanbasalt1 <- aggregate(mg_co_basal ~ treatment, data=respirationt1, FUN= mean)

plot_basal_t1 <- respirationt1 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= mg_co_basal, col=treatment))+
  geom_point(size=9)+
  scale_color_manual(values= treat.colors)+
  xlab("Treatments")+
  ylab("mg C-CO2/kg dry soil")+#basal
  stat_summary(fun=mean, aes(x= treatment, y = mg_co_basal),
               geom= "crossbar", colour= "black", width= 0.7, data=meanbasalt1)+
  geom_text(data=tukey_basalt1, aes(x=treatment, y = mg_co_basal, label= groups), 
            size= 4, colour="black", fontface = "bold", nudge_x= 0.2, nudge_y= 0.6)+
  labs(title = "Basal respiration at T1.", subtitle = "" , caption = "HSDTukey p-value")+
  theme(plot.title = element_text(size=1))+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()
plot_basal_t1
ggsave(plot_basal_t1, file="soil_respiration_result/dif_basal_t1.png", width= 1900,height= 1200, units= "px")
#analized induced
shapiro.test(respirationt1$mg_co_induced)#data induced no normal
soil_resp %>% group_by(treatment) %>% shapiro_test(mg_co_induced) #all data of each time of induced are normal
leveneTest(mg_co_induced~ treatment, data=respirationt1) #equal variance
anova_inducedt1 <- aov(mg_co_induced ~ treatment, data=respirationt1)#signification different 
summary(anova_inducedt1)
tukey_inducedt1 <- HSD.test(anova_inducedt1, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
tukey_inducedt1

meaninducedt1 <- aggregate(mg_co_induced ~ treatment, data=respirationt1, FUN= mean)

plot_induced_t1 <- respirationt1 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= mg_co_induced, col=treatment, group=treatment))+
  geom_point(size=9)+
  scale_color_manual(values= treat.colors)+
  xlab("Treatments")+
  ylab("mg C-CO2/kg dry soil")+#induced
  stat_summary(fun=mean, aes(x= treatment, y = mg_co_induced),
               geom= "crossbar", colour= "black", width= 0.7, data=meaninducedt1)+
  geom_text(data=tukey_inducedt1, aes(x=treatment, y = mg_co_induced, label= groups), 
            size= 4, colour="black", fontface = "bold", nudge_x= 0.2, nudge_y= 4.5)+
  labs(title = "Induced respiration at T1.", subtitle = "" , caption = "HSDTukey p-value")+
  theme(plot.title = element_text(size=1))+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()
plot_induced_t1
ggsave(plot_induced_t1, file="soil_respiration_result/dif_induced_t1.png", width= 1900,height= 1200, units= "px")
basal_induced_t1 <- ggarrange(plot_basal_t1,plot_induced_t1,
                              ncol=2,
                              common.legend = TRUE, legend = "none", 
                              labels = c("A", "B"), 
                              font.label = list (size = 10, color= "black"))
basal_induced_t1
ggsave(basal_induced_t1, file="soil_respiration_result/dif_basal_induced_t1.png", width= 1900,height= 1200, units= "px")
```

### Differences of respiration between treatments at T2


```{r respiration in t2, echo=FALSE}

respirationt2 <- subset(soil_resp, soil_resp$time == "t2")
#analized basal
shapiro.test(respirationt2$mg_co_basal)#data basal normal
leveneTest(mg_co_basal~ treatment, data=respirationt0) #equal Variance 

anova_basalt2 <- aov(mg_co_basal ~ treatment, data=respirationt2) #signification different 
summary(anova_basalt2)
tukey_basalt2 <- HSD.test(anova_basalt2, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
tukey_basalt2

meanbasalt2 <- aggregate(mg_co_basal ~ treatment, data=respirationt2, FUN= mean)

plot_basal_t2 <- respirationt2 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= mg_co_basal, col=treatment))+
  geom_point(size=9)+
  scale_color_manual(values= treat.colors)+
  xlab("Treatments")+
  ylab("mg C-CO2/kg dry soil")+#basal
  stat_summary(fun=mean, aes(x= treatment, y = mg_co_basal),
               geom= "crossbar", colour= "black", width= 0.7, data=meanbasalt2)+
  geom_text(data=tukey_basalt2, aes(x=treatment, y = mg_co_basal, label= groups), 
            size= 4, colour="black", fontface = "bold", nudge_x= 0.2, nudge_y= 0.6)+
  labs(title = "Basal respiration at t2.", subtitle = "" , caption = "HSDTukey p-value")+
  theme(plot.title = element_text(size=1))+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()
plot_basal_t2
ggsave(plot_basal_t2, file="soil_respiration_result/dif_basal_t2.png", width= 1900,height= 1200, units= "px")

#analized induced
shapiro.test(respirationt2$mg_co_induced)#data induced no normal
soil_resp %>% group_by(treatment) %>% shapiro_test(mg_co_induced) #all data of each time of induced are normal
leveneTest(mg_co_induced~ treatment, data=respirationt2) #equal variance
anova_inducedt2 <- aov(mg_co_induced ~ treatment, data=respirationt2)#signification different 
summary(anova_inducedt2)
tukey_inducedt2 <- HSD.test(anova_inducedt2, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
tukey_inducedt2

meaninducedt2 <- aggregate(mg_co_induced ~ treatment, data=respirationt2, FUN= mean)

plot_induced_t2 <- respirationt2 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= mg_co_induced, col=treatment, group=treatment))+
  geom_point(size=9)+
  scale_color_manual(values= treat.colors)+
  xlab("Treatments")+
  ylab("mg C-CO2/kg dry soil")+#induced
  stat_summary(fun=mean, aes(x= treatment, y = mg_co_induced),
               geom= "crossbar", colour= "black", width= 0.7, data=meaninducedt2)+
  geom_text(data=tukey_inducedt2, aes(x=treatment, y = mg_co_induced, label= groups), 
            size= 4, colour="black", fontface = "bold", nudge_x= 0.2, nudge_y= 4.5)+
  labs(title = "Induced respiration at t2.", subtitle = "" , caption = "HSDTukey p-value")+
  theme(plot.title = element_text(size=1))+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()
plot_induced_t2
ggsave(plot_induced_t2, file="soil_respiration_result/dif_induced_t2.png", width= 1900,height= 1200, units= "px")
basal_induced_t2 <- ggarrange(plot_basal_t2,plot_induced_t2,
                              ncol=2,
                              common.legend = TRUE, legend = "none", 
                              labels = c("A", "B"), 
                              font.label = list (size = 10, color= "black"))
basal_induced_t2
ggsave(basal_induced_t2, file="soil_respiration_result/dif_basal_induced_t2.png", width= 1900,height= 1200, units= "px")
```

### Differences of respiration between treatments at T3

```{r respiration at t3, echo=FALSE}
respirationt3 <- subset(soil_resp, soil_resp$time == "t3")
#analized basal
shapiro.test(respirationt3$mg_co_basal)#data basal normal
leveneTest(mg_co_basal~ treatment, data=respirationt0) #equal Variance 

anova_basalt3 <- aov(mg_co_basal ~ treatment, data=respirationt3) #signification different 
summary(anova_basalt3)
tukey_basalt3 <- HSD.test(anova_basalt3, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
tukey_basalt3

meanbasalt3 <- aggregate(mg_co_basal ~ treatment, data=respirationt3, FUN= mean)

plot_basal_t3 <- respirationt3 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= mg_co_basal, col=treatment))+
  geom_point(size=9)+
  scale_color_manual(values= treat.colors)+
  xlab("Treatments")+
  ylab("mg C-CO2/kg dry soil")+#basal
  stat_summary(fun=mean, aes(x= treatment, y = mg_co_basal),
               geom= "crossbar", colour= "black", width= 0.7, data=meanbasalt3)+
  geom_text(data=tukey_basalt3, aes(x=treatment, y = mg_co_basal, label= groups), 
            size= 4, colour="black", fontface = "bold", nudge_x= 0.2, nudge_y= 0.6)+
  labs(title = "Basal respiration at t3.", subtitle = "" , caption = "HSDTukey p-value")+
  theme(plot.title = element_text(size=1))+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()
plot_basal_t3
ggsave(plot_basal_t3, file="soil_respiration_result/dif_basal_t3.png", width= 1900,height= 1200, units= "px")
#analized induced
shapiro.test(respirationt3$mg_co_induced)#data induced no normal
soil_resp %>% group_by(treatment) %>% shapiro_test(mg_co_induced) #all data of each time of induced are normal
leveneTest(mg_co_induced~ treatment, data=respirationt3) #equal variance
anova_inducedt3 <- aov(mg_co_induced ~ treatment, data=respirationt3)#signification different 
summary(anova_inducedt3)
tukey_inducedt3 <- HSD.test(anova_inducedt3, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
tukey_inducedt3

meaninducedt3 <- aggregate(mg_co_induced ~ treatment, data=respirationt3, FUN= mean)

plot_induced_t3 <- respirationt3 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= mg_co_induced, col=treatment, group=treatment))+
  geom_point(size=9)+
  scale_color_manual(values= treat.colors)+
  xlab("Treatments")+
  ylab("mg C-CO2/kg dry soil")+#induced
  stat_summary(fun=mean, aes(x= treatment, y = mg_co_induced),
               geom= "crossbar", colour= "black", width= 0.7, data=meaninducedt3)+
  geom_text(data=tukey_inducedt3, aes(x=treatment, y = mg_co_induced, label= groups), 
            size= 4, colour="black", fontface = "bold", nudge_x= 0.2, nudge_y= 4.5)+
  labs(title = "Induced respiration at t3.", subtitle = "" , caption = "HSDTukey p-value")+
  theme(plot.title = element_text(size=1))+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()
plot_induced_t3
ggsave(plot_induced_t3, file="soil_respiration_result/dif_induced_t3.png", width= 1900,height= 1200, units= "px")
basal_induced_t3 <- ggarrange(plot_basal_t3,plot_induced_t3,
                              ncol=2,
                              common.legend = TRUE, legend = "none", 
                              labels = c("A", "B"), 
                              font.label = list (size = 10, color= "black"))
basal_induced_t3
ggsave(basal_induced_t3, file="soil_respiration_result/dif_basal_induced_t3.png", width= 1900,height= 1200, units= "px")
```


### Differences of respiration between treatments at T4


```{r respiration at t4, echo=FALSE}
respirationt4 <- subset(soil_resp, soil_resp$time == "t4")
#analized basal
shapiro.test(respirationt4$mg_co_basal)#data basal normal
leveneTest(mg_co_basal~ treatment, data=respirationt0) #equal Variance 

anova_basalt4 <- aov(mg_co_basal ~ treatment, data=respirationt4) #signification different 
summary(anova_basalt4)
tukey_basalt4 <- HSD.test(anova_basalt4, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
tukey_basalt4

meanbasalt4 <- aggregate(mg_co_basal ~ treatment, data=respirationt4, FUN= mean)

plot_basal_t4 <- respirationt4 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= mg_co_basal, col=treatment))+
  geom_point(size=9)+
  scale_color_manual(values= treat.colors)+
  xlab("Treatments")+
  ylab("mg C-CO2/kg dry soil")+#basal
  stat_summary(fun=mean, aes(x= treatment, y = mg_co_basal),
               geom= "crossbar", colour= "black", width= 0.7, data=meanbasalt4)+
  geom_text(data=tukey_basalt4, aes(x=treatment, y = mg_co_basal, label= groups), 
            size= 4, colour="black", fontface = "bold", nudge_x= 0.2, nudge_y= 0.6)+
  labs(title = "Basal respiration at t4.", subtitle = "" , caption = "HSDTukey p-value")+
  theme(plot.title = element_text(size=1))+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()
plot_basal_t4
ggsave(plot_basal_t4, file="soil_respiration_result/dif_basal_t4.png", width= 1900,height= 1200, units= "px")

#analized induced
shapiro.test(respirationt4$mg_co_induced)#data induced no normal
soil_resp %>% group_by(treatment) %>% shapiro_test(mg_co_induced) #all data of each time of induced are normal
leveneTest(mg_co_induced~ treatment, data=respirationt4) #equal variance
anova_inducedt4 <- aov(mg_co_induced ~ treatment, data=respirationt4)#signification different 
summary(anova_inducedt4)
tukey_inducedt4 <- HSD.test(anova_inducedt4, "treatment", alpha = 0.05)$groups %>% rownames_to_column(var= "treatment")
tukey_inducedt4

meaninducedt4 <- aggregate(mg_co_induced ~ treatment, data=respirationt4, FUN= mean)

plot_induced_t4 <- respirationt4 %>% ggplot(aes(x= factor(treatment, level= treat.order), y= mg_co_induced, col=treatment, group=treatment))+
  geom_point(size=9)+
  scale_color_manual(values= treat.colors)+
  xlab("Treatments")+
  ylab("mg C-CO2/kg dry soil")+#induced
  stat_summary(fun=mean, aes(x= treatment, y = mg_co_induced),
               geom= "crossbar", colour= "black", width= 0.7, data=meaninducedt4)+
  geom_text(data=tukey_inducedt4, aes(x=treatment, y = mg_co_induced, label= groups), 
            size= 4, colour="black", fontface = "bold", nudge_x= 0.2, nudge_y= 4.5)+
  labs(title = "Induced respiration at t4.", subtitle = "" , caption = "HSDTukey p-value")+
  theme(plot.title = element_text(size=1))+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()
plot_induced_t4
ggsave(plot_induced_t4, file="soil_respiration_result/dif_induced_t4.png", width= 1900,height= 1200, units= "px")
basal_induced_t4 <- ggarrange(plot_basal_t4,plot_induced_t4,
                              ncol=2,
                              common.legend = TRUE, legend = "none", 
                              labels = c("A", "B"), 
                              font.label = list (size = 10, color= "black"))
basal_induced_t4
ggsave(basal_induced_t4, file="soil_respiration_result/dif_basal_induced_t4.png", width= 1900,height= 1200, units= "px")

```

```{r resume, echo=FALSE}

respiration_basal_all <- grid.arrange(plot_basal_t0, plot_basal_t1, plot_basal_t2, plot_basal_t3, plot_basal_t4)
ggsave(respiration_basal_all, file="soil_respiration_result/respiration_basal_all.png", width= 1900,height= 1200, units= "px")

respiration_induced_all <- grid.arrange(plot_induced_t0, plot_induced_t1, plot_induced_t2, plot_induced_t3, plot_induced_t4)
ggsave(respiration_induced_all, file="soil_respiration_result/respiration_induced_all.png", width= 1900,height= 1200, units= "px")
```


### How much has the respiration of each treatment varied from the beginning of the experiment to the end (T4 and tT0)?


```{r change between t0 and t4, echo=FALSE}

respirationt0t4 <- soil_resp %>% filter(time == "t0" | time == "t4") #data only t0 and t4
respirationt0t4mean <- soil_resp_mean %>% filter(time == "t0" | time == "t4") #data only t0 and t4
#basal
shapiro.test(respirationt0t4$mg_co_basal)#normal data
leveneTest(mg_co_basal ~ time * treatment, data=respirationt0t4) #equal variances

anova_basalt0t4 <- aov(mg_co_basal ~ time + treatment, data=respirationt0t4) #anova two ways
summary(anova_basalt0t4)
anova_basalt0t4int <- aov(mg_co_basal ~ time * treatment , data=respirationt0t4) # interaction between them?
summary(anova_basalt0t4int)

basalt0t4lm <- lm(mg_co_basal~ time*treatment, data=respirationt0t4)#model
anova(basalt0t4lm)



emm_basalt0t4 <- emmeans(basalt0t4lm, pairwise ~ time | treatment)#emmeans
emm_basalt0t4$contrasts %>% rbind(adjust= "fdr") %>% summary(infer = TRUE)#el adjust es para el metodo de los pvalues
basalt0t4contras <- data.frame(emm_basalt0t4$contrasts)#data frame para sacar el valor del contraste 
basalt0t4contras
basalt0t4emmeans <- data.frame(emm_basalt0t4$emmeans) %>% group_by(treatment) %>% summarise(across(.cols= "emmean",.fns=mean),.groups = "drop")
basalt0t4emmeans

emm_basalt0t4 <- cld(emmeans(basalt0t4lm, specs = pairwise~treatment), Letters= letters, reversed= TRUE) #add letters
emm_basalt0t4
pval_basalt0t4_time <- data.frame(treatment= basalt0t4contras$treatment, pval= basalt0t4contras$p.value, emmean= basalt0t4emmeans$emmean)
pval_basalt0t4_time$sign <- ifelse(pval_basalt0t4_time$pval>0.05, paste("ns"),
                                 ifelse(pval_basalt0t4_time$pval>0.01, paste("*"),
                                        ifelse(pval_basalt0t4_time$pval> 0.001,
                                               paste("**"), paste("***"))))
basalt0t4_time <- respirationt0t4mean %>% ggplot(aes(x=factor(treatment, level= treat.order), y= mg_co_basal_mean))+
  geom_col(aes(fill= time),position= "dodge")+
  xlab("")+
  ylab("basal mg C-CO2/kg dry soil")+
  theme_classic2()+
  scale_x_discrete(labels= treat.labels)+
  geom_text(data = pval_basalt0t4_time, aes(x= treatment, y= emmean, label= sign), nudge_x= 0, nudge_y= 6)+
  geom_errorbar(data=respirationt0t4mean, aes(ymin=mg_co_basal_mean-mg_co_basal_sd, 
                                            ymax=mg_co_basal_mean+mg_co_basal_sd, group= time), position=position_dodge(0.9),
                                            size =0.2, width=0.2)
basalt0t4_time

#delta
delta_basalt0t4 <- data.frame (treatment=respirationt0$treatment, t4= respirationt4$mg_co_basal, t0=respirationt0$mg_co_basal)
delta_basalt0t4$delta <- delta_basalt0t4$t4-delta_basalt0t4$t0

delta_basalt0t4

delta_basalt0t4_lm <- lm(delta~ treatment, data=delta_basalt0t4)#model
anova(delta_basalt0t4_lm)

emm.delta.basalt0t4 <- emmeans(delta_basalt0t4_lm, pairwise ~  treatment)
emm.delta.basalt0t4
emm.delta.basalt0t4$contrasts %>% rbind(adjust= "fdr") %>% 
  summary(infer = TRUE)
emm.delta.basalt0t4 <- cld(emmeans(delta_basalt0t4_lm, specs = pairwise~treatment), Letters= letters, reversed= TRUE)
emm.delta.basalt0t4$.group
str(emm.delta.basalt0t4)
str(delta_basalt0t4)

plotdelta_basalt0t4 <- delta_basalt0t4 %>% ggplot(aes(x=factor(treatment, level= treat.order), y= delta, fill= treatment))+
  geom_point(pch= 21, size= 7)+
  xlab("")+
  ylab("Delta variation between t4-t0")+
  geom_hline(yintercept= 0, linetype = "dashed", color = "red")+
  scale_fill_manual(values= treat.colors)+
  geom_text(data= emm.delta.basalt0t4, aes(x= treatment, y= emmean, label= `.group`), nudge_x = 0.2, nudge_y = 0.2)+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()
plotdelta_basalt0t4

basal_t0t4plot <- ggarrange(basalt0t4_time, plotdelta_basalt0t4,
                              ncol=2,
                              common.legend = TRUE,
                              legend = c("left", "none"), 
                              labels = c("A", "B"),
                              font.label = list (size = 10, color= "black"))

basal_t0t4plot <- annotate_figure(basal_t0t4plot, 
                                  top = text_grob("Basal respiration", color = "black", face = "bold", size = 10),
                                  bottom = text_grob("Interaction and variation between beginning and end of the experiment", size=10))

basal_t0t4plot

ggsave(basal_t0t4plot, file="soil_respiration_result/interac_basal_t4.png", width= 1900,height= 1200, units= "px")

#induced
shapiro.test(respirationt0t4$mg_co_induced)# no normal data, but all data of each time of induced are normal
leveneTest(mg_co_induced ~ time * treatment, data=respirationt0t4) #equal variances

anova_inducedt0t4 <- aov(mg_co_induced~ time + treatment, data=respirationt0t4) #anova two ways
summary(anova_inducedt0t4)
anova_inducedt0t4int <- aov(mg_co_induced ~ time * treatment , data=respirationt0t4) # interaction between them?
summary(anova_inducedt0t4int)

inducedt0t4lm <- lm(mg_co_induced~ time*treatment, data=respirationt0t4)#model
anova(inducedt0t4lm)



emm_inducedt0t4 <- emmeans(inducedt0t4lm, pairwise ~ time | treatment)#emmeans
str(emm_inducedt0t4)

emm_inducedt0t4$contrasts %>% rbind(adjust= "fdr") %>% summary(infer = TRUE)#el adjust es para el metodo de los pvalues

inducedt0t4contras <- data.frame(emm_inducedt0t4$contrasts)#data frame para sacar el valor del contraste 

inducedt0t4contras

inducedt0t4emmeans <- data.frame(emm_inducedt0t4$emmeans) %>% group_by(treatment) %>% summarise(across(.cols= "emmean",.fns=mean),.groups = "drop")
inducedt0t4emmeans

emm_inducedt0t4 <- cld(emmeans(inducedt0t4lm, specs = pairwise~treatment), Letters= letters, reversed= TRUE) #add letters
emm_inducedt0t4
pval_inducedt0t4_time <- data.frame(treatment= inducedt0t4contras$treatment, pval= inducedt0t4contras$p.value, emmean= inducedt0t4emmeans$emmean)
pval_inducedt0t4_time$sign <- ifelse(pval_inducedt0t4_time$pval>0.05, paste("ns"),
                                 ifelse(pval_inducedt0t4_time$pval>0.01, paste("*"),
                                        ifelse(pval_inducedt0t4_time$pval> 0.001,
                                               paste("**"), paste("***"))))
inducedt0t4_time <- respirationt0t4mean %>% ggplot(aes(x=factor(treatment, level= treat.order), y= mg_co_induced_mean))+
  geom_col(aes(fill= time),position= "dodge")+
  xlab("")+
  ylab("induced mg C-CO2/kg dry soil")+
  theme_classic2()+
  scale_x_discrete(labels= treat.labels)+
  geom_text(data = pval_inducedt0t4_time, aes(x= treatment, y= emmean, label= sign), nudge_x= 0, nudge_y= 25)+
  geom_errorbar(data=respirationt0t4mean, aes(ymin=mg_co_induced_mean-mg_co_induced_sd, 
                                            ymax=mg_co_induced_mean+mg_co_induced_sd, group= time),
                position=position_dodge(0.9),
                                            size =0.2, width=0.2)
inducedt0t4_time

#delta

delta_inducedt0t4 <- data.frame (treatment=respirationt0$treatment, t4= respirationt4$mg_co_induced, t0=respirationt0$mg_co_induced)
delta_inducedt0t4$delta <- delta_inducedt0t4$t4-delta_inducedt0t4$t0

delta_inducedt0t4

delta_inducedt0t4_lm <- lm(delta~ treatment, data=delta_inducedt0t4)#model
anova(delta_inducedt0t4_lm)

emm.delta.inducedt0t4 <- emmeans(delta_inducedt0t4_lm, pairwise ~  treatment)
emm.delta.inducedt0t4
emm.delta.inducedt0t4$contrasts %>% rbind(adjust= "fdr") %>% 
  summary(infer = TRUE)
emm.delta.inducedt0t4 <- cld(emmeans(delta_inducedt0t4_lm, specs = pairwise~treatment), Letters= letters, reversed= TRUE)
emm.delta.inducedt0t4$.group
str(emm.delta.inducedt0t4)
str(delta_inducedt0t4)

plotdelta_inducedt0t4 <- delta_inducedt0t4 %>% ggplot(aes(x=factor(treatment, level= treat.order), y= delta, fill= treatment))+
  geom_point(pch= 21, size= 7)+
  xlab("")+
  ylab("Delta variation between t4-t0")+
  geom_hline(yintercept= 0, linetype = "dashed", color = "red")+
  scale_fill_manual(values= treat.colors)+
  geom_text(data= emm.delta.inducedt0t4, aes(x= treatment, y= emmean, label= `.group`), nudge_x = 0.2, nudge_y = 0.2)+
  scale_x_discrete(labels= treat.labels)+
  theme_classic2()

plotdelta_inducedt0t4

induced_t0t4plot <- ggarrange(inducedt0t4_time, plotdelta_inducedt0t4,
                              ncol=2,
                              common.legend = TRUE,
                              legend = c("left", "none"), 
                              labels = c("A", "B"), 
                              font.label = list (size = 10, color= "black"))

induced_t0t4plot

induced_t0t4plot <- annotate_figure(induced_t0t4plot, 
                                  top = text_grob("Induced respiration", color = "black", face = "bold", size = 10),
                                  bottom = text_grob("Interaction and variation between beginning and end of the experiment", size=10))

induced_t0t4plot
ggsave(induced_t0t4plot, file="soil_respiration_result/interac_induced_t4.png", width= 1900,height= 1200, units= "px")

```

